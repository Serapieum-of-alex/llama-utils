
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Llama-utils is a Python package for data manipulation and analysis in the Llama language model">
      
      
      
        <link rel="canonical" href="https://github.com/Serapieum-of-alex/llama-utils/develop/api/storage.html">
      
      
        <link rel="prev" href="index_manager.html">
      
      
        <link rel="next" href="pdf_reader.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Storage - Llama-utils</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#storage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Llama-utils" class="md-header__button md-logo" aria-label="Llama-utils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Llama-utils
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Storage
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../dev/installation.html" class="md-tabs__link">
          
  
    
  
  Installation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../design-architecture-diagrams.html" class="md-tabs__link">
          
  
    
  
  Design

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="index_manager.html" class="md-tabs__link">
          
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tools/ollama.html" class="md-tabs__link">
          
  
    
  
  LLM Tools

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tools/notebooks/llama-cpp.html" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../change-log.html" class="md-tabs__link">
        
  
    
  
  Change logs

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Llama-utils" class="md-nav__button md-logo" aria-label="Llama-utils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Llama-utils
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dev/installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../design-architecture-diagrams.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design and Architecture Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index_manager.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="storage.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage_1" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage" class="md-nav__link">
    <span class="md-ellipsis">
      storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.docstore" class="md-nav__link">
    <span class="md-ellipsis">
      docstore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.index_store" class="md-nav__link">
    <span class="md-ellipsis">
      index_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.node_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      node_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.store" class="md-nav__link">
    <span class="md-ellipsis">
      store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.vector_store" class="md-nav__link">
    <span class="md-ellipsis">
      vector_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.add_documents" class="md-nav__link">
    <span class="md-ellipsis">
      add_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.apply_extractors" class="md-nav__link">
    <span class="md-ellipsis">
      apply_extractors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.create" class="md-nav__link">
    <span class="md-ellipsis">
      create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.delete_document" class="md-nav__link">
    <span class="md-ellipsis">
      delete_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.delete_node" class="md-nav__link">
    <span class="md-ellipsis">
      delete_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.document_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      document_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.get_nodes_by_file_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_by_file_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.node_id_list" class="md-nav__link">
    <span class="md-ellipsis">
      node_id_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.read_documents" class="md-nav__link">
    <span class="md-ellipsis">
      read_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.create_metadata_index_existing_docs" class="md-nav__link">
    <span class="md-ellipsis">
      create_metadata_index_existing_docs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.read_metadata_index" class="md-nav__link">
    <span class="md-ellipsis">
      read_metadata_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.save_metadata_index" class="md-nav__link">
    <span class="md-ellipsis">
      save_metadata_index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pdf_reader.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pdf_reader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="utils.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LLM Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            LLM Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/ollama.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running a Local LLM using Ollama
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/llama-cpp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Llama.cpp for Local LLM Inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/notebooks/llama-cpp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Llama.cpp for Chat Completion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../change-log.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change logs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage_1" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage" class="md-nav__link">
    <span class="md-ellipsis">
      storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.docstore" class="md-nav__link">
    <span class="md-ellipsis">
      docstore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.index_store" class="md-nav__link">
    <span class="md-ellipsis">
      index_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.node_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      node_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.store" class="md-nav__link">
    <span class="md-ellipsis">
      store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.vector_store" class="md-nav__link">
    <span class="md-ellipsis">
      vector_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.add_documents" class="md-nav__link">
    <span class="md-ellipsis">
      add_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.apply_extractors" class="md-nav__link">
    <span class="md-ellipsis">
      apply_extractors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.create" class="md-nav__link">
    <span class="md-ellipsis">
      create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.delete_document" class="md-nav__link">
    <span class="md-ellipsis">
      delete_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.delete_node" class="md-nav__link">
    <span class="md-ellipsis">
      delete_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.document_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      document_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.get_nodes_by_file_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes_by_file_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.node_id_list" class="md-nav__link">
    <span class="md-ellipsis">
      node_id_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.read_documents" class="md-nav__link">
    <span class="md-ellipsis">
      read_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.Storage.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.create_metadata_index_existing_docs" class="md-nav__link">
    <span class="md-ellipsis">
      create_metadata_index_existing_docs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.read_metadata_index" class="md-nav__link">
    <span class="md-ellipsis">
      read_metadata_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llama_utils.retrieval.storage.save_metadata_index" class="md-nav__link">
    <span class="md-ellipsis">
      save_metadata_index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="storage">Storage</h1>
<h2 id="storage_1">Storage</h2>


<div class="doc doc-object doc-module">



<h2 id="llama_utils.retrieval.storage" class="doc doc-heading">
            <code>llama_utils.retrieval.storage</code>


</h2>

    <div class="doc doc-contents first">

        <p>A module for managing vector Storage and retrieval.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="llama_utils.retrieval.storage.Storage" class="doc doc-heading">
            <code>Storage</code>


</h3>


    <div class="doc doc-contents ">


        <p>A class to manage vector Storage and retrieval.</p>
<p>The Storage class is used to manage the storage and retrieval of documents. It provides methods to add documents to the
store, read documents from a directory, and extract information from the documents.</p>






              <details class="quote">
                <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Storage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class to manage vector Storage and retrieval.</span>

<span class="sd">    The Storage class is used to manage the storage and retrieval of documents. It provides methods to add documents to the</span>
<span class="sd">    store, read documents from a directory, and extract information from the documents.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">storage_context</span><span class="p">:</span> <span class="n">StorageContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Storage.</span>

<span class="sd">        The constructor method takes a llama_index.core.StorageContext object that is a native llamaIndex object</span>
<span class="sd">        and a metadata table (pandas.DataFrame-optional) as input.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storage_context: str, optional, default is None.</span>
<span class="sd">            the StorageContext object that is created by LlamaIndex (a native llamaIndex object).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storage_context</span><span class="p">,</span> <span class="n">StorageContext</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Storage class should be instantiated using StorageContext object, given: </span><span class="si">{</span><span class="n">storage_context</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_store</span> <span class="o">=</span> <span class="n">storage_context</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Storage&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new in-memory Storage.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Storage:</span>
<span class="sd">            The storage Context.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can create a new storage (in-memory) using the `create` method as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.create()</span>
<span class="sd">        &gt;&gt;&gt; print(store)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">                Documents: 0</span>
<span class="sd">                Indexes: 0</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">storage</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_simple_storage_context</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_simple_storage_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">StorageContext</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a simple Storage context.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        StorageContext:</span>
<span class="sd">            A storage context with docstore, vectore store, and index store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StorageContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span>
            <span class="n">docstore</span><span class="o">=</span><span class="n">SimpleDocumentStore</span><span class="p">(),</span>
            <span class="n">vector_store</span><span class="o">=</span><span class="n">SimpleVectorStore</span><span class="p">(),</span>
            <span class="n">index_store</span><span class="o">=</span><span class="n">SimpleIndexStore</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_metadata_index</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a metadata-based index.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">,</span> <span class="s2">&quot;doc_id&quot;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StorageContext</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Storage context.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">docstore</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDocumentStore</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the document store.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">docstore</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vector_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the vector store.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">vector_store</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">index_store</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseIndexStore</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the index store.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">index_store</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the storage to a directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        store_dir: str</span>
<span class="sd">            The directory to save the store.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can save a storage to a directory as follows:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.create()</span>
<span class="sd">        &gt;&gt;&gt; store.save(&quot;examples/paul-graham-essay-storage-example&quot;)</span>

<span class="sd">        ```</span>
<span class="sd">        The following files will be created in the specified directory:</span>
<span class="sd">        - metadata_index.csv</span>
<span class="sd">        - docstore.json</span>
<span class="sd">        - default__vector_store.json</span>
<span class="sd">        - index_store.json</span>
<span class="sd">        - graph_store.json</span>
<span class="sd">        - image__vector_store.json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="n">store_dir</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">store_dir</span><span class="p">,</span> <span class="n">ID_MAPPING_FILE</span><span class="p">)</span>
        <span class="n">save_metadata_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">(</span><span class="n">as_dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">file_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Storage&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the store from a directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        store_dir: str</span>
<span class="sd">            The directory containing the store.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Storage:</span>
<span class="sd">            The loaded storage.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        StorageNotFoundError</span>
<span class="sd">            If the storage is not found at the specified directory.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can load a storage from a directory as follows:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(store) # doctest: +SKIP</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">                    Documents: 53</span>
<span class="sd">                    Indexes: 2</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; metadata = store.document_metadata(as_dataframe=True)</span>
<span class="sd">        &gt;&gt;&gt; print(metadata.head()) # doctest: +SKIP</span>
<span class="sd">                                     doc_id                              node_id              file_name</span>
<span class="sd">        0   a25111e2e59f81bb7a0e3efb4825...  cadde590b82362fc7a5f8ce0751c5b30b...  paul_graham_essay.txt</span>
<span class="sd">        1   a25111e2e59f81bb7a0e3efb4825...  0567f3a9756983e1d040ec332255db945...  paul_graham_essay.txt</span>
<span class="sd">        2   a25111e2e59f81bb7a0e3efb4825...  d5542515414f1bf30f6c21f0796af8bde...  paul_graham_essay.txt</span>
<span class="sd">        3   a25111e2e59f81bb7a0e3efb4825...  120b69658a6c69ab8de3167b5ed0db779...  paul_graham_essay.txt</span>
<span class="sd">        &gt;&gt;&gt; docstore = store.docstore # doctest: +SKIP</span>
<span class="sd">        &lt;llama_index.core.storage.docstore.simple_docstore.SimpleDocumentStore at 0x20444d31be0&gt;</span>
<span class="sd">        &gt;&gt;&gt; vector_store = store.vector_store</span>
<span class="sd">        &gt;&gt;&gt; print(type(vector_store))</span>
<span class="sd">        &lt;class &#39;llama_index.core.vector_stores.simple.SimpleVectorStore&#39;&gt;</span>

<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">store_dir</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">StorageNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storage not found at </span><span class="si">{</span><span class="n">store_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">storage</span> <span class="o">=</span> <span class="n">StorageContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="n">store_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the storage.&quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Documents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span>
<span class="s2">        Indexes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_store</span><span class="o">.</span><span class="n">index_structs</span><span class="p">())</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the storage.&quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Documents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span>
<span class="s2">        Indexes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_store</span><span class="o">.</span><span class="n">index_structs</span><span class="p">())</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">node_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the metadata index.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">create_metadata_index_existing_docs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">document_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">as_dataframe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RefDocInfo</span><span class="p">],</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Document metadata.</span>

<span class="sd">        Get the metadata of all the documents in the docstore.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        as_dataframe: bool, optional, default is False.</span>
<span class="sd">            True to return the metadata as a DataFrame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, RefDocInfo] or DataFrame</span>
<span class="sd">            The metadata of all the documents in the docstore.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can get the document metadata as a dictionary using the `metadata` method with the default parameter values:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; metadata = store.document_metadata()</span>

<span class="sd">        ```</span>
<span class="sd">        The `metadata` is a dictionary with the document ID as the key and the document metadata as the value:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; documents_id = list(metadata.keys())</span>
<span class="sd">        &gt;&gt;&gt; print(documents_id) # doctest: +SKIP</span>
<span class="sd">        [&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;]</span>
<span class="sd">        &gt;&gt;&gt; print(metadata) # doctest: +SKIP</span>
<span class="sd">        {</span>
<span class="sd">            &#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;:</span>
<span class="sd">                RefDocInfo(</span>
<span class="sd">                    node_ids=[</span>
<span class="sd">                        &#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;,</span>
<span class="sd">                        &#39;0567f3a9756983e1d040ec332255db94521ed5dc1b03fc7312f653c0e670a0bf&#39;,</span>
<span class="sd">                        &#39;d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2df21f0810f10826252f&#39;,</span>
<span class="sd">                        &#39;120b69658a6c69ab8de3167b5ed0db77941a2b487e94d5d0e64a0d2d2805a4b7&#39;</span>
<span class="sd">                    ],</span>
<span class="sd">                    metadata={</span>
<span class="sd">                        &#39;file_path&#39;: &#39;examples\\data\\paul_graham_essay.txt&#39;,</span>
<span class="sd">                        &#39;file_name&#39;: &#39;paul_graham_essay.txt&#39;,</span>
<span class="sd">                        &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                        &#39;file_size&#39;: 75395,</span>
<span class="sd">                        &#39;creation_date&#39;: &#39;2024-10-24&#39;,</span>
<span class="sd">                        &#39;last_modified_date&#39;: &#39;2024-09-16&#39;,</span>
<span class="sd">                        &#39;document_title&#39;: &#39;Based on the candidate titles and content, I would suggest a***.&#39;</span>
<span class="sd">                    }</span>
<span class="sd">                )</span>
<span class="sd">            }</span>
<span class="sd">        ```</span>
<span class="sd">        To get the metadata as a DataFrame, you can set the `as_dataframe` parameter to True:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; metadata = store.document_metadata(as_dataframe=True)</span>
<span class="sd">        &gt;&gt;&gt; print(metadata) # doctest: +SKIP</span>
<span class="sd">                                                       doc_id                                            node_id</span>
<span class="sd">        0   a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff...  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>
<span class="sd">        1   a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff...  0567f3a9756983e1d040ec332255db94521ed5dc1b03fc...</span>
<span class="sd">        2   a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff...  d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d...</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ref_doc_info</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">get_all_ref_doc_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">as_dataframe</span><span class="p">:</span>
            <span class="n">doct_node_ids_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">file_name_doc</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">doc_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_doc_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">doc_ids</span><span class="p">:</span>
                <span class="c1"># get the DocRefInfo object for the first document</span>
                <span class="n">doc_ref</span> <span class="o">=</span> <span class="n">ref_doc_info</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                <span class="c1"># get the node ids for the first document</span>
                <span class="n">node_ids</span> <span class="o">=</span> <span class="n">doc_ref</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]</span>
                <span class="n">file_name_doc</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc_ref</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_name&quot;</span><span class="p">)</span>
                <span class="n">doct_node_ids_dict</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_ids</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">doct_node_ids_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="s2">&quot;node_id&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># merge the file name with the doc_id</span>
            <span class="n">file_name_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">file_name_doc</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">file_name_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s2">&quot;many_to_one&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">ref_doc_info</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">node_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the metadata of the nodes in the docstore.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Dict[str, Any]]</span>
<span class="sd">            The metadata of the nodes in the docstore.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can get the metadata of the nodes in the docstore using the `nodes_metadata` method:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes_metadata = store.node_id_list()</span>
<span class="sd">        &gt;&gt;&gt; print(nodes_metadata) # doctest: +SKIP</span>
<span class="sd">        [</span>
<span class="sd">            &#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;,</span>
<span class="sd">            &#39;0567f3a9756983e1d040ec332255db94521ed5dc1b03fc7312f653c0e670a0bf&#39;,</span>
<span class="sd">            &#39;d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2df21f0810f10826252f&#39;,</span>
<span class="sd">            ...</span>
<span class="sd">        ]</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">document_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a document from the docstore.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        doc_id: str, Optional, Default is None.</span>
<span class="sd">            The ID of the document to delete.</span>
<span class="sd">        document_name: str, optional, default is None.</span>
<span class="sd">            The name of the document to delete.</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - If the `doc_id` is provided, the document with the specified ID will be deleted.</span>
<span class="sd">        - If the `document_name` is provided, all the nodes related to the document with the specified name will be deleted.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can delete a document from the document store and all the nodes that are related to it using the</span>
<span class="sd">        `delete_document` method by providing the `document_id`:</span>

<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; from llama_utils.retrieval.storage import Storage</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; document_metadata = store.document_metadata</span>
<span class="sd">        &gt;&gt;&gt; document_id = list(document_metadata().keys())[0]</span>
<span class="sd">        &gt;&gt;&gt; print(document_id) # doctest: +SKIP</span>
<span class="sd">        a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092</span>
<span class="sd">        &gt;&gt;&gt; store.delete_document(document_id)</span>

<span class="sd">        ```</span>

<span class="sd">        Now if you check the document_metadata, you will find that the document is deleted:</span>

<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; print(store.document_metadata())</span>
<span class="sd">        {}</span>

<span class="sd">        ```</span>

<span class="sd">        You can also delete a document by providing the `document_name`:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(store.node_metadata.head()) # doctest: +SKIP</span>
<span class="sd">                       file_name                                            node_id</span>
<span class="sd">        0  paul_graham_essay.txt  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>
<span class="sd">        1  paul_graham_essay.txt  0567f3a9756983e1d040ec332255db94521ed5dc1b03fc...</span>
<span class="sd">        2  paul_graham_essay.txt  d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d...</span>
<span class="sd">        3  paul_graham_essay.txt  120b69658a6c69ab8de3167b5ed0db77941a2b487e94d5...</span>
<span class="sd">        4  paul_graham_essay.txt  c8587b5b5fc034bb08cd62cf0a082014f00fc09ccd2944...</span>
<span class="sd">        &gt;&gt;&gt; store.delete_document(document_name=&quot;paul_graham_essay.txt&quot;)</span>

<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">document_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">doc_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document with ID </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">delete_ref_doc</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_by_file_name</span><span class="p">(</span><span class="n">document_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="n">node_id</span><span class="o">.</span><span class="n">node_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a node from the docstore.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_id: str</span>
<span class="sd">            The ID of the node to delete.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can delete a node from the document store using the `delete_node` method by providing the `node_id`:</span>
<span class="sd">        ```</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">        &gt;&gt;&gt; node_id = store.node_id_list()[0]</span>
<span class="sd">        &gt;&gt;&gt; print(node_id)</span>
<span class="sd">        cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7</span>
<span class="sd">        &gt;&gt;&gt; store.delete_node(node_id)</span>

<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">delete_document</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_documents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">TextNode</span><span class="p">]],</span>
        <span class="n">generate_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add node/documents to the store.</span>

<span class="sd">        The `add_documents` method adds a node to the store. The node&#39;s id is a sha256 hash generated based on the</span>
<span class="sd">        node&#39;s text content. if the `update` parameter is True and the nodes already exist the existing node will</span>
<span class="sd">        be updated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        docs: Sequence[TextNode/Document]</span>
<span class="sd">            The node/documents to add to the store.</span>
<span class="sd">        generate_id: bool, optional, default is False.</span>
<span class="sd">            True if you want to generate a sha256 hash number as a doc_id based on the content of the nodes.</span>
<span class="sd">        update: bool, optional, default is True.</span>
<span class="sd">            True to update the document in the docstore if it already exist.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        - First create the storage object:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.create()</span>

<span class="sd">        - Then you can add documents to the store using the `add_documents` method:</span>

<span class="sd">        &gt;&gt;&gt; data_path = &quot;examples/data/essay&quot;</span>
<span class="sd">        &gt;&gt;&gt; documents = Storage.read_documents(data_path)</span>
<span class="sd">        &gt;&gt;&gt; store.add_documents(documents)</span>
<span class="sd">        &gt;&gt;&gt; print(store)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">                Documents: 1</span>
<span class="sd">                Indexes: 0</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        - once the documents are added successfully, they are added also to the metadata index.</span>

<span class="sd">        &gt;&gt;&gt; metadata = store.node_metadata</span>
<span class="sd">        &gt;&gt;&gt; print(metadata) # doctest: +SKIP</span>
<span class="sd">                        file_name                                            node_id</span>
<span class="sd">        0   paul_graham_essay.txt  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>

<span class="sd">        &gt;&gt;&gt; docstore = store.docstore</span>
<span class="sd">        &gt;&gt;&gt; print(docstore.docs) # doctest: +SKIP</span>

<span class="sd">        {</span>
<span class="sd">            &#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;:</span>
<span class="sd">                Document(</span>
<span class="sd">                    id_=&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;,</span>
<span class="sd">                    embedding=None,</span>
<span class="sd">                    metadata={</span>
<span class="sd">                        &#39;file_path&#39;: &#39;examples\\data\\essay\\paul-graham-essay.txt&#39;,</span>
<span class="sd">                        &#39;file_name&#39;: &#39;paul-graham-essay.txt&#39;,</span>
<span class="sd">                        &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                        &#39;file_size&#39;: 75395,</span>
<span class="sd">                        &#39;creation_date&#39;: &#39;2024-10-25&#39;,</span>
<span class="sd">                        &#39;last_modified_date&#39;: &#39;2024-09-16&#39;</span>
<span class="sd">                    },</span>
<span class="sd">                    excluded_embed_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">                    excluded_llm_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">                    relationships={},</span>
<span class="sd">                    text=&#39;What I Worked On February 2021 Before college the two ...&#39;,</span>
<span class="sd">                    mimetype=&#39;text/plain&#39;,</span>
<span class="sd">                    start_char_idx=None,</span>
<span class="sd">                    end_char_idx=None,</span>
<span class="sd">                    text_template=&#39;{metadata_str}\n\n{content}&#39;,</span>
<span class="sd">                    metadata_template=&#39;{key}: {value}&#39;,</span>
<span class="sd">                    metadata_seperator=&#39;\n&#39;</span>
<span class="sd">                )</span>
<span class="sd">        }</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="c1"># change the id to a sha256 hash if it is not already</span>
            <span class="k">if</span> <span class="n">generate_id</span><span class="p">:</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">generate_content_hash</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">document_exists</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">node_id</span><span class="p">)</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">add_documents</span><span class="p">([</span><span class="n">doc</span><span class="p">],</span> <span class="n">allow_update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document with ID </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> already exists. Skipping.&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_documents</span><span class="p">(</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">split_into_nodes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="n">chunk_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">TextNode</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Read documents from a directory and optionally splits them into TextNodes.</span>

<span class="sd">        the `read_documents` method reads documents from a directory and returns a list of documents.</span>
<span class="sd">        the `doc_id` is sha256 hash number generated based on the document&#39;s text content.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            path to the directory containing the documents. or a single file path.</span>
<span class="sd">        split_into_nodes : bool, optional</span>
<span class="sd">            If True, splits documents into smaller TextNodes (default: False).</span>
<span class="sd">        chunk_size : int, optional, default is 1024</span>
<span class="sd">            The size of each text chunk. The `chunk_size` Defines the size of each split chunk (in characters).</span>
<span class="sd">            - Larger values preserve more context but increase memory usage.</span>
<span class="sd">            - Smaller values improve retrieval specificity but may lose context.</span>
<span class="sd">        chunk_overlap : int, optional, default is 100.</span>
<span class="sd">            The overlap size between chunks. The `chunk_overlap` ensures adjacent chunks have overlapping content to</span>
<span class="sd">            preserve context.</span>
<span class="sd">            - Higher overlap improves retrieval coherence but increases redundancy.</span>
<span class="sd">            - Lower overlap minimizes redundancy but might break context.</span>
<span class="sd">        show_progress: bool, optional, default is False.</span>
<span class="sd">            True to show progress bar.</span>
<span class="sd">        num_workers: int, optional, default is None.</span>
<span class="sd">            The number of workers to use for loading the data.</span>
<span class="sd">        recursive: bool, optional, default is False.</span>
<span class="sd">            True to read from subdirectories.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Sequence[Union[Document, TextNode]]</span>
<span class="sd">            The documents/nodes read from the store.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">            If the directory is not found.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The best values for `chunk_size` and `chunk_overlap` depend on the type of documents and retrieval needs.</span>

<span class="sd">        | **Use Case**                                              | **Recommended `chunk_size`** | **Recommended `chunk_overlap`** |</span>
<span class="sd">        |-----------------------------------------------------------|------------------------------|---------------------------------|</span>
<span class="sd">        | **Short documents (FAQs, structured text, emails)**       | `256 - 512`                  | `50`                           |</span>
<span class="sd">        | **General-purpose (news articles, reports, blog posts)**  | `512 - 1024`                 | `50 - 100`                     |</span>
<span class="sd">        | **Long documents (PDFs, research papers, books)**         | `1024 - 2048`                | `100 - 200`                    |</span>
<span class="sd">        | **Dense technical/scientific papers**                     | `1500 - 2500`                | `200 - 300`                    |</span>
<span class="sd">        | **Conversational AI (chat context memory)**               | `512 - 1024`                 | `50 - 150`                     |</span>
<span class="sd">        | **Legal/contract documents (precise context retention)**  | `2048 - 4096`                | `200 - 400`                    |</span>

<span class="sd">        Best Practices:</span>
<span class="sd">        - For most cases, `chunk_size=1024` and `chunk_overlap=100` work well.</span>
<span class="sd">        - If working with FAQs, decrease `chunk_size` to `512`.</span>
<span class="sd">        - If preserving long-form LLM context, use `2048+` with higher overlap.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        You can read documents from a directory as follows:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; from llama_utils.retrieval.storage import Storage</span>
<span class="sd">        &gt;&gt;&gt; data_path = &quot;examples/data/essay&quot;</span>
<span class="sd">        &gt;&gt;&gt; docs = Storage.read_documents(data_path)</span>
<span class="sd">        &gt;&gt;&gt; print(docs) # doctest: +SKIP</span>
<span class="sd">        [</span>
<span class="sd">            Document(</span>
<span class="sd">                id_=&#39;a25111e2e59f81bb7a0e3efb48255**&#39;,</span>
<span class="sd">                embedding=None,</span>
<span class="sd">                metadata={</span>
<span class="sd">                    &#39;file_path&#39;: &#39;examples/data/essay/paul-graham-essay.txt&#39;,</span>
<span class="sd">                    &#39;file_name&#39;: &#39;paul-graham-essay.txt&#39;,</span>
<span class="sd">                    &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                    &#39;file_size&#39;: 75395,</span>
<span class="sd">                    &#39;creation_date&#39;: &#39;2024-10-25&#39;,</span>
<span class="sd">                    &#39;last_modified_date&#39;: &#39;2024-09-16&#39;</span>
<span class="sd">                },</span>
<span class="sd">                excluded_embed_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">                excluded_llm_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">                relationships={},</span>
<span class="sd">                text=&#39;What I Worked On\n\nFebruary 2021\n\nBefore college the two main things ****&#39;,</span>
<span class="sd">                mimetype=&#39;text/plain&#39;,</span>
<span class="sd">                start_char_idx=None,</span>
<span class="sd">                end_char_idx=None,</span>
<span class="sd">        4        text_template=&#39;{metadata_str}\n\n{content}&#39;,</span>
<span class="sd">                metadata_template=&#39;{key}: {value}&#39;,</span>
<span class="sd">                metadata_seperator=&#39;\n&#39;</span>
<span class="sd">            )</span>
<span class="sd">        ]</span>
<span class="sd">        ```</span>

<span class="sd">        You can also use the `split_into_nodes` parameter to split the documents into smaller nodes:</span>

<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; docs = Storage.read_documents(data_path, split_into_nodes=True)</span>
<span class="sd">        &gt;&gt;&gt; print(len(docs))</span>
<span class="sd">        20</span>
<span class="sd">        &gt;&gt;&gt; print(docs[0]) # doctest: +SKIP</span>
<span class="sd">        Node ID: bfdf48ff-3c2b-49a8-ae25-7a837158d2dc</span>
<span class="sd">        Text: What I Worked On    February 2021    Before college the two main</span>
<span class="sd">        things I worked on, outside of school, were writing and programming. I</span>
<span class="sd">        didn&#39;t write essays. I wrote what beginning writers were supposed to</span>
<span class="sd">        write then, and probably still are: short stories. My stories were</span>
<span class="sd">        awful. They had hardly any plot, just characters with strong feelings,</span>
<span class="sd">        whic...</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">SimpleDirectoryReader</span><span class="p">(</span><span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">SimpleDirectoryReader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">documents</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span>
            <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">split_into_nodes</span><span class="p">:</span>
            <span class="c1"># Split documents into nodes.</span>
            <span class="n">splitter</span> <span class="o">=</span> <span class="n">SentenceSplitter</span><span class="p">(</span>
                <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">chunk_overlap</span><span class="o">=</span><span class="n">chunk_overlap</span>
            <span class="p">)</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">get_nodes_from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
            <span class="c1"># exclude the file name from the llm metadata to avoid affecting the llm by weird file names</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">excluded_llm_metadata_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
            <span class="c1"># exclude the file name from the embeddings&#39; metadata to avoid affecting the llm by weird file names</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">excluded_embed_metadata_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
            <span class="c1"># Generate a hash based on the document&#39;s text content</span>
            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">generate_content_hash</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="c1"># Assign the hash as the doc_id</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;content-hash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_hash</span>

        <span class="k">return</span> <span class="n">documents</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_by_file_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exact_match</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get nodes by file name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name: str</span>
<span class="sd">            The file name to search for.</span>
<span class="sd">        exact_match: bool, optional, default is False</span>
<span class="sd">            True to search for an exact match, False to search for a partial match.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[TextNode]</span>
<span class="sd">            The nodes with the specified file name.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        - First read the storage context from a directory:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; storage_dir = &quot;examples/paul-graham-essay-storage&quot;</span>
<span class="sd">        &gt;&gt;&gt; store = Storage.load(storage_dir)</span>
<span class="sd">        &gt;&gt;&gt; print(store)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">                Documents: 53</span>
<span class="sd">                Indexes: 2</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        - The storage context contains the following data:</span>

<span class="sd">        &gt;&gt;&gt; print(store.node_metadata.head(3))</span>
<span class="sd">                       file_name                                            node_id</span>
<span class="sd">        0  paul_graham_essay.txt  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>
<span class="sd">        1  paul_graham_essay.txt  0567f3a9756983e1d040ec332255db94521ed5dc1b03fc...</span>
<span class="sd">        2  paul_graham_essay.txt  d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d...</span>


<span class="sd">        You can get all the nodes for file `paul_graham_essay.txt` as follows:</span>


<span class="sd">        &gt;&gt;&gt; nodes = store.get_nodes_by_file_name(&quot;paul_graham_essay.txt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; nodes[0] # doctest: +SKIP</span>
<span class="sd">        TextNode(</span>
<span class="sd">            id_=&#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;,</span>
<span class="sd">            embedding=None,</span>
<span class="sd">            metadata={</span>
<span class="sd">                &#39;file_path&#39;: &#39;examples\\data\\paul_graham_essay.txt&#39;,</span>
<span class="sd">                &#39;file_name&#39;: &#39;paul_graham_essay.txt&#39;,</span>
<span class="sd">                &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                &#39;file_size&#39;: 75395,</span>
<span class="sd">                &#39;creation_date&#39;: &#39;2024-10-24&#39;,</span>
<span class="sd">                &#39;last_modified_date&#39;: &#39;2024-09-16&#39;,</span>
<span class="sd">                &#39;document_title&#39;: &#39;Based on the candidate titles and content, I would suggest a comprehensive title</span>
<span class="sd">                    that captures the essence of the text. Here\&#39;s a potential title:\n\n&quot;From Early Days ***&#39;</span>
<span class="sd">            },</span>
<span class="sd">            excluded_embed_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">            excluded_llm_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">            relationships={</span>
<span class="sd">                &lt;NodeRelationship.SOURCE: &#39;1&#39;&gt;:</span>
<span class="sd">                RelatedNodeInfo(</span>
<span class="sd">                    node_id=&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;,</span>
<span class="sd">                    node_type=&lt;ObjectType.DOCUMENT: &#39;4&#39;&gt;,</span>
<span class="sd">                    metadata={</span>
<span class="sd">                        &#39;file_path&#39;: &#39;examples\\data\\paul_graham_essay.txt&#39;,</span>
<span class="sd">                        &#39;file_name&#39;: &#39;paul_graham_essay.txt&#39;,</span>
<span class="sd">                        &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                        &#39;file_size&#39;: 75395,</span>
<span class="sd">                        &#39;creation_date&#39;: &#39;2024-10-24&#39;,</span>
<span class="sd">                        &#39;last_modified_date&#39;: &#39;2024-09-16&#39;</span>
<span class="sd">                    },</span>
<span class="sd">                    hash=&#39;2a494d84cd0ab1e73396773258b809a47739482c90b80d5f61d374e754c3ef06&#39;</span>
<span class="sd">                ),</span>
<span class="sd">                &lt;NodeRelationship.NEXT: &#39;3&#39;&gt;: RelatedNodeInfo(node_id=&#39;15478c7a-fdab-40c8-92e7-42973b9d3b28&#39;, node_type=&lt;ObjectType.TEXT: &#39;1&#39;&gt;, metadata={}, hash=&#39;424546c0aa78015988ced235522cdd238633d5edc1b92667cbdcda44d72613ec&#39;)}, text=&#39;What I Worked On\r\n\r\nFebruary 2021\r\n\r\nBefore college the two main things I worked on, outside of school, were writing and programming. I didn\&#39;t write essays. I wrote what beginning writers were supposed to write then, and probably still are: short stories. My stories were awful. They had hardly any plot, just characters with strong feelings, which I imagined made them deep.\r\n\r\nThe first programs I tried writing were on the IBM 1401 that our school district used for what was then called &quot;data processing.&quot; This was in 9th grade, so I was 13 or 14. The school district\&#39;s 1401 happened to be in the basement of our junior high school, and my friend Rich Draves and I got permission to use it. It was like a mini Bond villain\&#39;s lair down there, with all these alien-looking machines  CPU, disk drives, printer, card reader  sitting up on a raised floor under bright fluorescent lights.\r\n\r\nThe language we used was an early version of Fortran. You had to type programs on punch cards, then stack them in the card reader and press a button to load the program into memory and run it. The result would ordinarily be to print something on the spectacularly loud printer.\r\n\r\nI was puzzled by the 1401. I couldn\&#39;t figure out what to do with it. And in retrospect there\&#39;s not much I could have&#39;,</span>
<span class="sd">                mimetype=&#39;text/plain&#39;,</span>
<span class="sd">                start_char_idx=4,</span>
<span class="sd">                end_char_idx=2027,</span>
<span class="sd">                text_template=&#39;[Excerpt from document]\n{metadata_str}\nExcerpt:\n-----\n{content}\n-----\n&#39;,</span>
<span class="sd">                metadata_template=&#39;{key}: {value}&#39;, metadata_seperator=&#39;\n&#39;</span>
<span class="sd">                )</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_metadata</span>
        <span class="k">if</span> <span class="n">exact_match</span><span class="p">:</span>
            <span class="n">doc_ids</span> <span class="o">=</span> <span class="n">metadata_index</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">metadata_index</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;node_id&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doc_ids</span> <span class="o">=</span> <span class="n">metadata_index</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">metadata_index</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;node_id&quot;</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">docs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_extractors</span><span class="p">(</span>
        <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">BaseNode</span><span class="p">]],</span>
        <span class="n">extractors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extract information from a list of documents using predefined extractors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        documents : List[Union[Document, BaseNode]]</span>
<span class="sd">            List of documents or nodes to process. Each document should be an instance of `Document` or `BaseNode`.</span>
<span class="sd">        extractors : Dict[str, Dict[str, Any]], optional</span>
<span class="sd">            A dictionary defining the information extraction configuration. If not provided, default extractors will be used.</span>

<span class="sd">            - Example format for `info`</span>

<span class="sd">             .. code-block:: rst</span>

<span class="sd">                {</span>
<span class="sd">                    &quot;text_splitter&quot;: {&quot;separator&quot;: &quot; &quot;, &quot;chunk_size&quot;: 512, &quot;chunk_overlap&quot;: 128},</span>
<span class="sd">                    &quot;title&quot;: {&quot;nodes&quot;: 5},</span>
<span class="sd">                    &quot;question_answer&quot;: {&quot;questions&quot;: 3},</span>
<span class="sd">                    &quot;summary&quot;: {&quot;summaries&quot;: [&quot;prev&quot;, &quot;self&quot;]},</span>
<span class="sd">                    &quot;keyword&quot;: {&quot;keywords&quot;: 10},</span>
<span class="sd">                    &quot;entity&quot;: {&quot;prediction_threshold&quot;: 0.5}</span>
<span class="sd">                }</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Sequence[BaseNode]</span>
<span class="sd">            A sequence of processed nodes with extracted metadata. Extracted data is stored in the node&#39;s `metadata`</span>
<span class="sd">            field under the following keys:</span>

<span class="sd">                - &quot;document_title&quot;: Extracted title.</span>
<span class="sd">                - &quot;questions_this_excerpt_can_answer&quot;: Extracted questions.</span>
<span class="sd">                - &quot;summary&quot;: Extracted summaries.</span>
<span class="sd">                - &quot;keywords&quot;: Extracted keywords.</span>
<span class="sd">                - &quot;entities&quot;: Extracted entities.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        First create a config loader object:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; from llama_utils.utils.config_loader import ConfigLoader</span>
<span class="sd">        &gt;&gt;&gt; config_loader = ConfigLoader()</span>

<span class="sd">        ```</span>

<span class="sd">        You can extract information from a single document as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; docs = [Document(text=&quot;Sample text&quot;, metadata={})]</span>
<span class="sd">        &gt;&gt;&gt; extractors_info = {</span>
<span class="sd">        ...     &quot;text_splitter&quot;: {&quot;separator&quot;: &quot; &quot;, &quot;chunk_size&quot;: 512, &quot;chunk_overlap&quot;: 128},</span>
<span class="sd">        ...     &quot;title&quot;: {&quot;nodes&quot;: 5},</span>
<span class="sd">        ...     &quot;summary&quot;: {&quot;summaries&quot;: [&quot;prev&quot;, &quot;self&quot;]}</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; extracted_nodes = Storage.apply_extractors(docs, extractors_info) # doctest: +SKIP</span>
<span class="sd">        Parsing nodes: 100%|| 1/1 [00:00&lt;00:00, 1000.31it/s]</span>
<span class="sd">        100%|| 1/1 [00:05&lt;00:00,  5.82s/it]</span>
<span class="sd">        100%|| 1/1 [00:00&lt;00:00,  1.54it/s]</span>
<span class="sd">        &gt;&gt;&gt; len(extracted_nodes) # doctest: +SKIP</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; print(extracted_nodes[0].document_metadata) # doctest: +SKIP</span>
<span class="sd">        {</span>
<span class="sd">            &#39;document_title&#39;: &quot;I&#39;m excited to help! Unfortunately, there doesn&#39;t seem to be any text provided.</span>
<span class="sd">                Please go ahead and share the sample text, and I&#39;ll do my best to give you a comprehensive title</span>
<span class="sd">                that summarizes all the unique entities, titles, or themes found in it.&quot;,</span>
<span class="sd">            &#39;section_summary&#39;: &quot;I apologize, but since there is no provided text, I have nothing to summarize.</span>
<span class="sd">                Please provide the sample text, and I&#39;ll be happy to help you summarize the key topics and</span>
<span class="sd">                entities!&quot;</span>
<span class="sd">        }</span>
<span class="sd">        ```</span>
<span class="sd">        You can extract information from a list of documents as follows:</span>

<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; data_path = &quot;examples/data/essay&quot;</span>
<span class="sd">        &gt;&gt;&gt; docs = Storage.read_documents(data_path)</span>
<span class="sd">        &gt;&gt;&gt; extractors_info = {</span>
<span class="sd">        ...     &quot;text_splitter&quot;: {&quot;separator&quot;: &quot; &quot;, &quot;chunk_size&quot;: 512, &quot;chunk_overlap&quot;: 128},</span>
<span class="sd">        ...     &quot;title&quot;: {&quot;nodes&quot;: 5},</span>
<span class="sd">        ...     &quot;question_answer&quot;: {&quot;questions&quot;: 1},</span>
<span class="sd">        ... }</span>

<span class="sd">        &gt;&gt;&gt; extracted_docs = Storage.apply_extractors(docs, extractors_info) # doctest: +SKIP</span>
<span class="sd">        Parsing nodes: 100%|| 1/1 [00:00&lt;00:00,  4.52it/s]</span>
<span class="sd">        100%|| 5/5 [00:15&lt;00:00,  3.19s/it]</span>
<span class="sd">        100%|| 53/53 [03:46&lt;00:00,  4.27s/it]</span>
<span class="sd">         26%|       | 14/53 [00:48&lt;02:08,  3.29s/it]</span>
<span class="sd">        100%|| 53/53 [00:47&lt;00:00,  1.13it/s]</span>
<span class="sd">        &gt;&gt;&gt; len(extracted_docs) # doctest: +SKIP</span>
<span class="sd">        53</span>
<span class="sd">        &gt;&gt;&gt; print(extracted_docs[0]) # doctest: +SKIP</span>
<span class="sd">        Node ID: 9b4fca22-7f1f-4876-bb71-d4b29500daa3</span>
<span class="sd">        Text: What I Worked On    February 2021    Before college the two main</span>
<span class="sd">        things I worked on, outside of school, were writing and programming. I</span>
<span class="sd">        didn&#39;t write essays. I wrote what beginning writers were supposed to</span>
<span class="sd">        write then, and probably still are: short stories. My stories were</span>
<span class="sd">        awful. They had hardly any plot, just characters with strong feelings,</span>
<span class="sd">        whic...</span>
<span class="sd">        &gt;&gt;&gt; print(extracted_docs[0].extra_info) # doctest: +SKIP</span>
<span class="sd">        {</span>
<span class="sd">            &#39;file_path&#39;: &#39;examples\\data\\essay\\paul-graham-essay.txt&#39;,</span>
<span class="sd">            &#39;file_name&#39;: &#39;paul-graham-essay.txt&#39;,</span>
<span class="sd">            &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">            &#39;file_size&#39;: 75395,</span>
<span class="sd">            &#39;creation_date&#39;: &#39;2024-10-25&#39;,</span>
<span class="sd">            &#39;last_modified_date&#39;: &#39;2024-09-16&#39;,</span>
<span class="sd">            &#39;document_title&#39;: &#39;After reviewing the potential titles and themes mentioned in the context,</span>
<span class="sd">                I would suggest the following comprehensive title \n\n&quot;A Personal Odyssey ***,&#39;.</span>
<span class="sd">            &#39;questions_this_excerpt_can_answer&#39;: &quot;Based on the provided context, here&#39;s a question that this</span>
<span class="sd">                context can specifically answer:\n\nWhat was Paul Graham&#39;s experience with the IBM ***&quot;,</span>
<span class="sd">            &#39;section_summary&#39;: &#39;Here is a summary of the key topics and entities in the section:\n\n**Key</span>
<span class="sd">                Topics:**\n\n1. Paul Graham\&#39;s early experiences with writing and programming.\n2. His work on ***&#39;,</span>
<span class="sd">            &#39;excerpt_keywords&#39;: &#39;Here are three unique keywords for this document:\n\nPaul Graham, IBM 1401,</span>
<span class="sd">                Microcomputers&#39;</span>
<span class="sd">        }</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extractors</span> <span class="o">=</span> <span class="n">EXTRACTORS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">extractors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">extractors</span>

        <span class="n">extractors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">EXTRACTORS</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="o">**</span><span class="n">val</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extractors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">EXTRACTORS</span>
        <span class="p">]</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">IngestionPipeline</span><span class="p">(</span><span class="n">transformations</span><span class="o">=</span><span class="n">extractors</span><span class="p">)</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
            <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="llama_utils.retrieval.storage.Storage.docstore" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">docstore</span><span class="p">:</span> <span class="n">BaseDocumentStore</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Get the document store.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="llama_utils.retrieval.storage.Storage.index_store" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">index_store</span><span class="p">:</span> <span class="n">BaseIndexStore</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Get the index store.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="llama_utils.retrieval.storage.Storage.node_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_metadata</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Get the metadata index.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="llama_utils.retrieval.storage.Storage.store" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">store</span><span class="p">:</span> <span class="n">StorageContext</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Get the Storage context.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="llama_utils.retrieval.storage.Storage.vector_store" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vector_store</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Get the vector store.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">storage_context</span><span class="p">:</span> <span class="n">StorageContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize the Storage.</p>
<p>The constructor method takes a llama_index.core.StorageContext object that is a native llamaIndex object
and a metadata table (pandas.DataFrame-optional) as input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>storage_context</code>
            </td>
            <td>
                  <code><span title="llama_index.core.StorageContext">StorageContext</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the StorageContext object that is created by LlamaIndex (a native llamaIndex object).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">storage_context</span><span class="p">:</span> <span class="n">StorageContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Storage.</span>

<span class="sd">    The constructor method takes a llama_index.core.StorageContext object that is a native llamaIndex object</span>
<span class="sd">    and a metadata table (pandas.DataFrame-optional) as input.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storage_context: str, optional, default is None.</span>
<span class="sd">        the StorageContext object that is created by LlamaIndex (a native llamaIndex object).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storage_context</span><span class="p">,</span> <span class="n">StorageContext</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Storage class should be instantiated using StorageContext object, given: </span><span class="si">{</span><span class="n">storage_context</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_store</span> <span class="o">=</span> <span class="n">storage_context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a string representation of the storage.</p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a string representation of the storage.&quot;&quot;&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Documents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span>
<span class="s2">    Indexes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_store</span><span class="o">.</span><span class="n">index_structs</span><span class="p">())</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a string representation of the storage.</p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a string representation of the storage.&quot;&quot;&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Documents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span>
<span class="s2">    Indexes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_store</span><span class="o">.</span><span class="n">index_structs</span><span class="p">())</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.add_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">TextNode</span><span class="p">]],</span> <span class="n">generate_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Add node/documents to the store.</p>
<p>The <code>add_documents</code> method adds a node to the store. The node's id is a sha256 hash generated based on the
node's text content. if the <code>update</code> parameter is True and the nodes already exist the existing node will
be updated.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>docs</code>
            </td>
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="typing.Union">Union</span>[<span title="llama_index.core.schema.Document">Document</span>, <span title="llama_index.core.schema.TextNode">TextNode</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The node/documents to add to the store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>generate_id</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if you want to generate a sha256 hash number as a doc_id based on the content of the nodes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to update the document in the docstore if it already exist.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <ul>
<li>First create the storage object:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

<span class="o">-</span> <span class="n">Then</span> <span class="n">you</span> <span class="n">can</span> <span class="n">add</span> <span class="n">documents</span> <span class="n">to</span> <span class="n">the</span> <span class="n">store</span> <span class="n">using</span> <span class="n">the</span> <span class="err">`</span><span class="n">add_documents</span><span class="err">`</span> <span class="n">method</span><span class="p">:</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/essay&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">documents</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">read_documents</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">store</span><span class="o">.</span><span class="n">add_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>
        <span class="n">Documents</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">Indexes</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>

<span class="o">-</span> <span class="n">once</span> <span class="n">the</span> <span class="n">documents</span> <span class="n">are</span> <span class="n">added</span> <span class="n">successfully</span><span class="p">,</span> <span class="n">they</span> <span class="n">are</span> <span class="n">added</span> <span class="n">also</span> <span class="n">to</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">index</span><span class="o">.</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">node_metadata</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
                <span class="n">file_name</span>                                            <span class="n">node_id</span>
<span class="mi">0</span>   <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="n">cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7</span><span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">docstore</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">docstore</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>

<span class="p">{</span>
    <span class="s1">&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;</span><span class="p">:</span>
        <span class="n">Document</span><span class="p">(</span>
            <span class="n">id_</span><span class="o">=</span><span class="s1">&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;</span><span class="p">,</span>
            <span class="n">embedding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="s1">&#39;examples</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">essay</span><span class="se">\\</span><span class="s1">paul-graham-essay.txt&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;paul-graham-essay.txt&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="mi">75395</span><span class="p">,</span>
                <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-10-25&#39;</span><span class="p">,</span>
                <span class="s1">&#39;last_modified_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-09-16&#39;</span>
            <span class="p">},</span>
            <span class="n">excluded_embed_metadata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span>
            <span class="n">excluded_llm_metadata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span>
            <span class="n">relationships</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;What I Worked On February 2021 Before college the two ...&#39;</span><span class="p">,</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
            <span class="n">start_char_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">end_char_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">text_template</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{metadata_str}</span><span class="se">\n\n</span><span class="si">{content}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">metadata_template</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{key}</span><span class="s1">: </span><span class="si">{value}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">metadata_seperator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_documents</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">docs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">TextNode</span><span class="p">]],</span>
    <span class="n">generate_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add node/documents to the store.</span>

<span class="sd">    The `add_documents` method adds a node to the store. The node&#39;s id is a sha256 hash generated based on the</span>
<span class="sd">    node&#39;s text content. if the `update` parameter is True and the nodes already exist the existing node will</span>
<span class="sd">    be updated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    docs: Sequence[TextNode/Document]</span>
<span class="sd">        The node/documents to add to the store.</span>
<span class="sd">    generate_id: bool, optional, default is False.</span>
<span class="sd">        True if you want to generate a sha256 hash number as a doc_id based on the content of the nodes.</span>
<span class="sd">    update: bool, optional, default is True.</span>
<span class="sd">        True to update the document in the docstore if it already exist.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    - First create the storage object:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.create()</span>

<span class="sd">    - Then you can add documents to the store using the `add_documents` method:</span>

<span class="sd">    &gt;&gt;&gt; data_path = &quot;examples/data/essay&quot;</span>
<span class="sd">    &gt;&gt;&gt; documents = Storage.read_documents(data_path)</span>
<span class="sd">    &gt;&gt;&gt; store.add_documents(documents)</span>
<span class="sd">    &gt;&gt;&gt; print(store)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">            Documents: 1</span>
<span class="sd">            Indexes: 0</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    - once the documents are added successfully, they are added also to the metadata index.</span>

<span class="sd">    &gt;&gt;&gt; metadata = store.node_metadata</span>
<span class="sd">    &gt;&gt;&gt; print(metadata) # doctest: +SKIP</span>
<span class="sd">                    file_name                                            node_id</span>
<span class="sd">    0   paul_graham_essay.txt  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>

<span class="sd">    &gt;&gt;&gt; docstore = store.docstore</span>
<span class="sd">    &gt;&gt;&gt; print(docstore.docs) # doctest: +SKIP</span>

<span class="sd">    {</span>
<span class="sd">        &#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;:</span>
<span class="sd">            Document(</span>
<span class="sd">                id_=&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;,</span>
<span class="sd">                embedding=None,</span>
<span class="sd">                metadata={</span>
<span class="sd">                    &#39;file_path&#39;: &#39;examples\\data\\essay\\paul-graham-essay.txt&#39;,</span>
<span class="sd">                    &#39;file_name&#39;: &#39;paul-graham-essay.txt&#39;,</span>
<span class="sd">                    &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                    &#39;file_size&#39;: 75395,</span>
<span class="sd">                    &#39;creation_date&#39;: &#39;2024-10-25&#39;,</span>
<span class="sd">                    &#39;last_modified_date&#39;: &#39;2024-09-16&#39;</span>
<span class="sd">                },</span>
<span class="sd">                excluded_embed_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">                excluded_llm_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">                relationships={},</span>
<span class="sd">                text=&#39;What I Worked On February 2021 Before college the two ...&#39;,</span>
<span class="sd">                mimetype=&#39;text/plain&#39;,</span>
<span class="sd">                start_char_idx=None,</span>
<span class="sd">                end_char_idx=None,</span>
<span class="sd">                text_template=&#39;{metadata_str}\n\n{content}&#39;,</span>
<span class="sd">                metadata_template=&#39;{key}: {value}&#39;,</span>
<span class="sd">                metadata_seperator=&#39;\n&#39;</span>
<span class="sd">            )</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
        <span class="c1"># change the id to a sha256 hash if it is not already</span>
        <span class="k">if</span> <span class="n">generate_id</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">generate_content_hash</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">document_exists</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">node_id</span><span class="p">)</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">add_documents</span><span class="p">([</span><span class="n">doc</span><span class="p">],</span> <span class="n">allow_update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document with ID </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> already exists. Skipping.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.apply_extractors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_extractors</span><span class="p">(</span><span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">BaseNode</span><span class="p">]],</span> <span class="n">extractors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Extract information from a list of documents using predefined extractors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>documents</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="llama_index.core.schema.Document">Document</span>, <span title="llama_index.core.schema.BaseNode">BaseNode</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of documents or nodes to process. Each document should be an instance of <code>Document</code> or <code>BaseNode</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extractors</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>[str, Any]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary defining the information extraction configuration. If not provided, default extractors will be used.</p>
<ul>
<li>Example format for <code>info</code></li>
</ul>
<p>.. code-block:: rst</p>
<div class="highlight"><pre><span></span><code>{
    &quot;text_splitter&quot;: {&quot;separator&quot;: &quot; &quot;, &quot;chunk_size&quot;: 512, &quot;chunk_overlap&quot;: 128},
    &quot;title&quot;: {&quot;nodes&quot;: 5},
    &quot;question_answer&quot;: {&quot;questions&quot;: 3},
    &quot;summary&quot;: {&quot;summaries&quot;: [&quot;prev&quot;, &quot;self&quot;]},
    &quot;keyword&quot;: {&quot;keywords&quot;: 10},
    &quot;entity&quot;: {&quot;prediction_threshold&quot;: 0.5}
}
</code></pre></div>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="llama_index.core.schema.BaseNode">BaseNode</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A sequence of processed nodes with extracted metadata. Extracted data is stored in the node's <code>metadata</code>
field under the following keys:</p>
<div class="highlight"><pre><span></span><code>- &quot;document_title&quot;: Extracted title.
- &quot;questions_this_excerpt_can_answer&quot;: Extracted questions.
- &quot;summary&quot;: Extracted summaries.
- &quot;keywords&quot;: Extracted keywords.
- &quot;entities&quot;: Extracted entities.
</code></pre></div>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>First create a config loader object:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">llama_utils.utils.config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigLoader</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">config_loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">()</span>
</code></pre></div></p>
<p>You can extract information from a single document as follows:</p>
<p><div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">docs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Sample text&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{})]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">extractors_info</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">...</span>     <span class="s2">&quot;text_splitter&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;separator&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="s2">&quot;chunk_overlap&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">},</span>
<span class="o">...</span>     <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
<span class="o">...</span>     <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;summaries&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;prev&quot;</span><span class="p">,</span> <span class="s2">&quot;self&quot;</span><span class="p">]}</span>
<span class="o">...</span> <span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">extracted_nodes</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">apply_extractors</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">extractors_info</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="n">Parsing</span> <span class="n">nodes</span><span class="p">:</span> <span class="mi">100</span><span class="o">%|</span><span class="err"></span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">1000.31</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
<span class="mi">100</span><span class="o">%|</span><span class="err"></span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">5.82</span><span class="n">s</span><span class="o">/</span><span class="n">it</span><span class="p">]</span>
<span class="mi">100</span><span class="o">%|</span><span class="err"></span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.54</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted_nodes</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">extracted_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="p">{</span>
    <span class="s1">&#39;document_title&#39;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m excited to help! Unfortunately, there doesn&#39;t seem to be any text provided.</span>
        <span class="n">Please</span> <span class="n">go</span> <span class="n">ahead</span> <span class="ow">and</span> <span class="n">share</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">text</span><span class="p">,</span> <span class="ow">and</span> <span class="n">I</span><span class="s1">&#39;ll do my best to give you a comprehensive title</span>
        <span class="n">that</span> <span class="n">summarizes</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">unique</span> <span class="n">entities</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="ow">or</span> <span class="n">themes</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="s2">&quot;,</span>
    <span class="s1">&#39;section_summary&#39;</span><span class="p">:</span> <span class="s2">&quot;I apologize, but since there is no provided text, I have nothing to summarize.</span>
        <span class="n">Please</span> <span class="n">provide</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">text</span><span class="p">,</span> <span class="ow">and</span> <span class="n">I</span><span class="s1">&#39;ll be happy to help you summarize the key topics and</span>
        <span class="n">entities</span><span class="err">!</span><span class="s2">&quot;</span>
<span class="p">}</span>
</code></pre></div>
You can extract information from a list of documents as follows:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/essay&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">docs</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">read_documents</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">extractors_info</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">...</span>     <span class="s2">&quot;text_splitter&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;separator&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;chunk_size&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="s2">&quot;chunk_overlap&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">},</span>
<span class="o">...</span>     <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
<span class="o">...</span>     <span class="s2">&quot;question_answer&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;questions&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="o">...</span> <span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">extracted_docs</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">apply_extractors</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">extractors_info</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="n">Parsing</span> <span class="n">nodes</span><span class="p">:</span> <span class="mi">100</span><span class="o">%|</span><span class="err"></span><span class="o">|</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">4.52</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
<span class="mi">100</span><span class="o">%|</span><span class="err"></span><span class="o">|</span> <span class="mi">5</span><span class="o">/</span><span class="mi">5</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">3.19</span><span class="n">s</span><span class="o">/</span><span class="n">it</span><span class="p">]</span>
<span class="mi">100</span><span class="o">%|</span><span class="err"></span><span class="o">|</span> <span class="mi">53</span><span class="o">/</span><span class="mi">53</span> <span class="p">[</span><span class="mi">03</span><span class="p">:</span><span class="mi">46</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">4.27</span><span class="n">s</span><span class="o">/</span><span class="n">it</span><span class="p">]</span>
 <span class="mi">26</span><span class="o">%|</span><span class="err"></span>       <span class="o">|</span> <span class="mi">14</span><span class="o">/</span><span class="mi">53</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">48</span><span class="o">&lt;</span><span class="mi">02</span><span class="p">:</span><span class="mi">08</span><span class="p">,</span>  <span class="mf">3.29</span><span class="n">s</span><span class="o">/</span><span class="n">it</span><span class="p">]</span>
<span class="mi">100</span><span class="o">%|</span><span class="err"></span><span class="o">|</span> <span class="mi">53</span><span class="o">/</span><span class="mi">53</span> <span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">47</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span>  <span class="mf">1.13</span><span class="n">it</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted_docs</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="mi">53</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">extracted_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># doctest: +SKIP</span>
<span class="n">Node</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">9</span><span class="n">b4fca22</span><span class="o">-</span><span class="mi">7</span><span class="n">f1f</span><span class="o">-</span><span class="mi">4876</span><span class="o">-</span><span class="n">bb71</span><span class="o">-</span><span class="n">d4b29500daa3</span>
<span class="n">Text</span><span class="p">:</span> <span class="n">What</span> <span class="n">I</span> <span class="n">Worked</span> <span class="n">On</span>    <span class="n">February</span> <span class="mi">2021</span>    <span class="n">Before</span> <span class="n">college</span> <span class="n">the</span> <span class="n">two</span> <span class="n">main</span>
<span class="n">things</span> <span class="n">I</span> <span class="n">worked</span> <span class="n">on</span><span class="p">,</span> <span class="n">outside</span> <span class="n">of</span> <span class="n">school</span><span class="p">,</span> <span class="n">were</span> <span class="n">writing</span> <span class="ow">and</span> <span class="n">programming</span><span class="o">.</span> <span class="n">I</span>
<span class="n">didn</span><span class="s1">&#39;t write essays. I wrote what beginning writers were supposed to</span>
<span class="n">write</span> <span class="n">then</span><span class="p">,</span> <span class="ow">and</span> <span class="n">probably</span> <span class="n">still</span> <span class="n">are</span><span class="p">:</span> <span class="n">short</span> <span class="n">stories</span><span class="o">.</span> <span class="n">My</span> <span class="n">stories</span> <span class="n">were</span>
<span class="n">awful</span><span class="o">.</span> <span class="n">They</span> <span class="n">had</span> <span class="n">hardly</span> <span class="nb">any</span> <span class="n">plot</span><span class="p">,</span> <span class="n">just</span> <span class="n">characters</span> <span class="k">with</span> <span class="n">strong</span> <span class="n">feelings</span><span class="p">,</span>
<span class="n">whic</span><span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">extracted_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extra_info</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="p">{</span>
    <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="s1">&#39;examples</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">essay</span><span class="se">\\</span><span class="s1">paul-graham-essay.txt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;paul-graham-essay.txt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="mi">75395</span><span class="p">,</span>
    <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-10-25&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last_modified_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-09-16&#39;</span><span class="p">,</span>
    <span class="s1">&#39;document_title&#39;</span><span class="p">:</span> <span class="s1">&#39;After reviewing the potential titles and themes mentioned in the context,</span>
        <span class="n">I</span> <span class="n">would</span> <span class="n">suggest</span> <span class="n">the</span> <span class="n">following</span> <span class="n">comprehensive</span> <span class="n">title</span> \<span class="n">n</span>\<span class="n">n</span><span class="s2">&quot;A Personal Odyssey ***,&#39;.</span>
    <span class="s1">&#39;questions_this_excerpt_can_answer&#39;</span><span class="p">:</span> <span class="s2">&quot;Based on the provided context, here&#39;s a question that this</span>
        <span class="n">context</span> <span class="n">can</span> <span class="n">specifically</span> <span class="n">answer</span><span class="p">:</span>\<span class="n">n</span>\<span class="n">nWhat</span> <span class="n">was</span> <span class="n">Paul</span> <span class="n">Graham</span><span class="s1">&#39;s experience with the IBM ***&quot;,</span>
    <span class="s1">&#39;section_summary&#39;</span><span class="p">:</span> <span class="s1">&#39;Here is a summary of the key topics and entities in the section:</span><span class="se">\n\n</span><span class="s1">**Key</span>
        <span class="n">Topics</span><span class="p">:</span><span class="o">**</span>\<span class="n">n</span>\<span class="n">n1</span><span class="o">.</span> <span class="n">Paul</span> <span class="n">Graham</span>\<span class="s1">&#39;s early experiences with writing and programming.</span><span class="se">\n</span><span class="s1">2. His work on ***&#39;</span><span class="p">,</span>
    <span class="s1">&#39;excerpt_keywords&#39;</span><span class="p">:</span> <span class="s1">&#39;Here are three unique keywords for this document:</span><span class="se">\n\n</span><span class="s1">Paul Graham, IBM 1401,</span>
        <span class="n">Microcomputers</span><span class="s1">&#39;</span>
<span class="p">}</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_extractors</span><span class="p">(</span>
    <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">BaseNode</span><span class="p">]],</span>
    <span class="n">extractors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extract information from a list of documents using predefined extractors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    documents : List[Union[Document, BaseNode]]</span>
<span class="sd">        List of documents or nodes to process. Each document should be an instance of `Document` or `BaseNode`.</span>
<span class="sd">    extractors : Dict[str, Dict[str, Any]], optional</span>
<span class="sd">        A dictionary defining the information extraction configuration. If not provided, default extractors will be used.</span>

<span class="sd">        - Example format for `info`</span>

<span class="sd">         .. code-block:: rst</span>

<span class="sd">            {</span>
<span class="sd">                &quot;text_splitter&quot;: {&quot;separator&quot;: &quot; &quot;, &quot;chunk_size&quot;: 512, &quot;chunk_overlap&quot;: 128},</span>
<span class="sd">                &quot;title&quot;: {&quot;nodes&quot;: 5},</span>
<span class="sd">                &quot;question_answer&quot;: {&quot;questions&quot;: 3},</span>
<span class="sd">                &quot;summary&quot;: {&quot;summaries&quot;: [&quot;prev&quot;, &quot;self&quot;]},</span>
<span class="sd">                &quot;keyword&quot;: {&quot;keywords&quot;: 10},</span>
<span class="sd">                &quot;entity&quot;: {&quot;prediction_threshold&quot;: 0.5}</span>
<span class="sd">            }</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Sequence[BaseNode]</span>
<span class="sd">        A sequence of processed nodes with extracted metadata. Extracted data is stored in the node&#39;s `metadata`</span>
<span class="sd">        field under the following keys:</span>

<span class="sd">            - &quot;document_title&quot;: Extracted title.</span>
<span class="sd">            - &quot;questions_this_excerpt_can_answer&quot;: Extracted questions.</span>
<span class="sd">            - &quot;summary&quot;: Extracted summaries.</span>
<span class="sd">            - &quot;keywords&quot;: Extracted keywords.</span>
<span class="sd">            - &quot;entities&quot;: Extracted entities.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    First create a config loader object:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; from llama_utils.utils.config_loader import ConfigLoader</span>
<span class="sd">    &gt;&gt;&gt; config_loader = ConfigLoader()</span>

<span class="sd">    ```</span>

<span class="sd">    You can extract information from a single document as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; docs = [Document(text=&quot;Sample text&quot;, metadata={})]</span>
<span class="sd">    &gt;&gt;&gt; extractors_info = {</span>
<span class="sd">    ...     &quot;text_splitter&quot;: {&quot;separator&quot;: &quot; &quot;, &quot;chunk_size&quot;: 512, &quot;chunk_overlap&quot;: 128},</span>
<span class="sd">    ...     &quot;title&quot;: {&quot;nodes&quot;: 5},</span>
<span class="sd">    ...     &quot;summary&quot;: {&quot;summaries&quot;: [&quot;prev&quot;, &quot;self&quot;]}</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; extracted_nodes = Storage.apply_extractors(docs, extractors_info) # doctest: +SKIP</span>
<span class="sd">    Parsing nodes: 100%|| 1/1 [00:00&lt;00:00, 1000.31it/s]</span>
<span class="sd">    100%|| 1/1 [00:05&lt;00:00,  5.82s/it]</span>
<span class="sd">    100%|| 1/1 [00:00&lt;00:00,  1.54it/s]</span>
<span class="sd">    &gt;&gt;&gt; len(extracted_nodes) # doctest: +SKIP</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; print(extracted_nodes[0].document_metadata) # doctest: +SKIP</span>
<span class="sd">    {</span>
<span class="sd">        &#39;document_title&#39;: &quot;I&#39;m excited to help! Unfortunately, there doesn&#39;t seem to be any text provided.</span>
<span class="sd">            Please go ahead and share the sample text, and I&#39;ll do my best to give you a comprehensive title</span>
<span class="sd">            that summarizes all the unique entities, titles, or themes found in it.&quot;,</span>
<span class="sd">        &#39;section_summary&#39;: &quot;I apologize, but since there is no provided text, I have nothing to summarize.</span>
<span class="sd">            Please provide the sample text, and I&#39;ll be happy to help you summarize the key topics and</span>
<span class="sd">            entities!&quot;</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>
<span class="sd">    You can extract information from a list of documents as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; data_path = &quot;examples/data/essay&quot;</span>
<span class="sd">    &gt;&gt;&gt; docs = Storage.read_documents(data_path)</span>
<span class="sd">    &gt;&gt;&gt; extractors_info = {</span>
<span class="sd">    ...     &quot;text_splitter&quot;: {&quot;separator&quot;: &quot; &quot;, &quot;chunk_size&quot;: 512, &quot;chunk_overlap&quot;: 128},</span>
<span class="sd">    ...     &quot;title&quot;: {&quot;nodes&quot;: 5},</span>
<span class="sd">    ...     &quot;question_answer&quot;: {&quot;questions&quot;: 1},</span>
<span class="sd">    ... }</span>

<span class="sd">    &gt;&gt;&gt; extracted_docs = Storage.apply_extractors(docs, extractors_info) # doctest: +SKIP</span>
<span class="sd">    Parsing nodes: 100%|| 1/1 [00:00&lt;00:00,  4.52it/s]</span>
<span class="sd">    100%|| 5/5 [00:15&lt;00:00,  3.19s/it]</span>
<span class="sd">    100%|| 53/53 [03:46&lt;00:00,  4.27s/it]</span>
<span class="sd">     26%|       | 14/53 [00:48&lt;02:08,  3.29s/it]</span>
<span class="sd">    100%|| 53/53 [00:47&lt;00:00,  1.13it/s]</span>
<span class="sd">    &gt;&gt;&gt; len(extracted_docs) # doctest: +SKIP</span>
<span class="sd">    53</span>
<span class="sd">    &gt;&gt;&gt; print(extracted_docs[0]) # doctest: +SKIP</span>
<span class="sd">    Node ID: 9b4fca22-7f1f-4876-bb71-d4b29500daa3</span>
<span class="sd">    Text: What I Worked On    February 2021    Before college the two main</span>
<span class="sd">    things I worked on, outside of school, were writing and programming. I</span>
<span class="sd">    didn&#39;t write essays. I wrote what beginning writers were supposed to</span>
<span class="sd">    write then, and probably still are: short stories. My stories were</span>
<span class="sd">    awful. They had hardly any plot, just characters with strong feelings,</span>
<span class="sd">    whic...</span>
<span class="sd">    &gt;&gt;&gt; print(extracted_docs[0].extra_info) # doctest: +SKIP</span>
<span class="sd">    {</span>
<span class="sd">        &#39;file_path&#39;: &#39;examples\\data\\essay\\paul-graham-essay.txt&#39;,</span>
<span class="sd">        &#39;file_name&#39;: &#39;paul-graham-essay.txt&#39;,</span>
<span class="sd">        &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">        &#39;file_size&#39;: 75395,</span>
<span class="sd">        &#39;creation_date&#39;: &#39;2024-10-25&#39;,</span>
<span class="sd">        &#39;last_modified_date&#39;: &#39;2024-09-16&#39;,</span>
<span class="sd">        &#39;document_title&#39;: &#39;After reviewing the potential titles and themes mentioned in the context,</span>
<span class="sd">            I would suggest the following comprehensive title \n\n&quot;A Personal Odyssey ***,&#39;.</span>
<span class="sd">        &#39;questions_this_excerpt_can_answer&#39;: &quot;Based on the provided context, here&#39;s a question that this</span>
<span class="sd">            context can specifically answer:\n\nWhat was Paul Graham&#39;s experience with the IBM ***&quot;,</span>
<span class="sd">        &#39;section_summary&#39;: &#39;Here is a summary of the key topics and entities in the section:\n\n**Key</span>
<span class="sd">            Topics:**\n\n1. Paul Graham\&#39;s early experiences with writing and programming.\n2. His work on ***&#39;,</span>
<span class="sd">        &#39;excerpt_keywords&#39;: &#39;Here are three unique keywords for this document:\n\nPaul Graham, IBM 1401,</span>
<span class="sd">            Microcomputers&#39;</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">extractors</span> <span class="o">=</span> <span class="n">EXTRACTORS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">extractors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">extractors</span>

    <span class="n">extractors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">EXTRACTORS</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="o">**</span><span class="n">val</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extractors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">EXTRACTORS</span>
    <span class="p">]</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">IngestionPipeline</span><span class="p">(</span><span class="n">transformations</span><span class="o">=</span><span class="n">extractors</span><span class="p">)</span>

    <span class="n">nodes</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
        <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Storage</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Create a new in-memory Storage.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Storage</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="llama_utils.retrieval.storage.Storage" href="#llama_utils.retrieval.storage.Storage">Storage</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The storage Context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>You can create a new storage (in-memory) using the <code>create</code> method as follows:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>
        <span class="n">Documents</span><span class="p">:</span> <span class="mi">0</span>
        <span class="n">Indexes</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Storage&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new in-memory Storage.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Storage:</span>
<span class="sd">        The storage Context.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can create a new storage (in-memory) using the `create` method as follows:</span>

<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.create()</span>
<span class="sd">    &gt;&gt;&gt; print(store)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">            Documents: 0</span>
<span class="sd">            Indexes: 0</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_simple_storage_context</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.delete_document" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_document</span><span class="p">(</span><span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">document_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Delete a document from the docstore.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the document to delete.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>document_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the document to delete.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>If the <code>doc_id</code> is provided, the document with the specified ID will be deleted.</li>
<li>If the <code>document_name</code> is provided, all the nodes related to the document with the specified name will be deleted.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <p>You can delete a document from the document store and all the nodes that are related to it using the
<code>delete_document</code> method by providing the <code>document_id</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">llama_utils.retrieval.storage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Storage</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;examples/paul-graham-essay-storage&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">document_metadata</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">document_metadata</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">document_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">document_metadata</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">document_id</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="n">a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">store</span><span class="o">.</span><span class="n">delete_document</span><span class="p">(</span><span class="n">document_id</span><span class="p">)</span>
</code></pre></div>
<p>Now if you check the document_metadata, you will find that the document is deleted:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">())</span>
<span class="p">{}</span>
</code></pre></div>
<p>You can also delete a document by providing the <code>document_name</code>:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;examples/paul-graham-essay-storage&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">node_metadata</span><span class="o">.</span><span class="n">head</span><span class="p">())</span> <span class="c1"># doctest: +SKIP</span>
               <span class="n">file_name</span>                                            <span class="n">node_id</span>
<span class="mi">0</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="n">cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7</span><span class="o">...</span>
<span class="mi">1</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="mi">0567</span><span class="n">f3a9756983e1d040ec332255db94521ed5dc1b03fc</span><span class="o">...</span>
<span class="mi">2</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="n">d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d</span><span class="o">...</span>
<span class="mi">3</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="mi">120</span><span class="n">b69658a6c69ab8de3167b5ed0db77941a2b487e94d5</span><span class="o">...</span>
<span class="mi">4</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="n">c8587b5b5fc034bb08cd62cf0a082014f00fc09ccd2944</span><span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">store</span><span class="o">.</span><span class="n">delete_document</span><span class="p">(</span><span class="n">document_name</span><span class="o">=</span><span class="s2">&quot;paul_graham_essay.txt&quot;</span><span class="p">)</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">document_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a document from the docstore.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    doc_id: str, Optional, Default is None.</span>
<span class="sd">        The ID of the document to delete.</span>
<span class="sd">    document_name: str, optional, default is None.</span>
<span class="sd">        The name of the document to delete.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - If the `doc_id` is provided, the document with the specified ID will be deleted.</span>
<span class="sd">    - If the `document_name` is provided, all the nodes related to the document with the specified name will be deleted.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can delete a document from the document store and all the nodes that are related to it using the</span>
<span class="sd">    `delete_document` method by providing the `document_id`:</span>

<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; from llama_utils.retrieval.storage import Storage</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">    &gt;&gt;&gt; document_metadata = store.document_metadata</span>
<span class="sd">    &gt;&gt;&gt; document_id = list(document_metadata().keys())[0]</span>
<span class="sd">    &gt;&gt;&gt; print(document_id) # doctest: +SKIP</span>
<span class="sd">    a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092</span>
<span class="sd">    &gt;&gt;&gt; store.delete_document(document_id)</span>

<span class="sd">    ```</span>

<span class="sd">    Now if you check the document_metadata, you will find that the document is deleted:</span>

<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; print(store.document_metadata())</span>
<span class="sd">    {}</span>

<span class="sd">    ```</span>

<span class="sd">    You can also delete a document by providing the `document_name`:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(store.node_metadata.head()) # doctest: +SKIP</span>
<span class="sd">                   file_name                                            node_id</span>
<span class="sd">    0  paul_graham_essay.txt  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>
<span class="sd">    1  paul_graham_essay.txt  0567f3a9756983e1d040ec332255db94521ed5dc1b03fc...</span>
<span class="sd">    2  paul_graham_essay.txt  d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d...</span>
<span class="sd">    3  paul_graham_essay.txt  120b69658a6c69ab8de3167b5ed0db77941a2b487e94d5...</span>
<span class="sd">    4  paul_graham_essay.txt  c8587b5b5fc034bb08cd62cf0a082014f00fc09ccd2944...</span>
<span class="sd">    &gt;&gt;&gt; store.delete_document(document_name=&quot;paul_graham_essay.txt&quot;)</span>

<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">document_name</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">doc_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document with ID </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">delete_ref_doc</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes_by_file_name</span><span class="p">(</span><span class="n">document_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="n">node_id</span><span class="o">.</span><span class="n">node_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.delete_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Delete a node from the docstore.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the node to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>You can delete a node from the document store using the <code>delete_node</code> method by providing the <code>node_id</code>:
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)
&gt;&gt;&gt; node_id = store.node_id_list()[0]
&gt;&gt;&gt; print(node_id)
cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7
&gt;&gt;&gt; store.delete_node(node_id)
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a node from the docstore.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    node_id: str</span>
<span class="sd">        The ID of the node to delete.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can delete a node from the document store using the `delete_node` method by providing the `node_id`:</span>
<span class="sd">    ```</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">    &gt;&gt;&gt; node_id = store.node_id_list()[0]</span>
<span class="sd">    &gt;&gt;&gt; print(node_id)</span>
<span class="sd">    cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7</span>
<span class="sd">    &gt;&gt;&gt; store.delete_node(node_id)</span>

<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">delete_document</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.document_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">document_metadata</span><span class="p">(</span><span class="n">as_dataframe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RefDocInfo</span><span class="p">],</span> <span class="n">DataFrame</span><span class="p">]</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Document metadata.</p>
<p>Get the metadata of all the documents in the docstore.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>as_dataframe</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[bool]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to return the metadata as a DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="llama_index.core.storage.docstore.types.RefDocInfo">RefDocInfo</span>] or <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metadata of all the documents in the docstore.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>You can get the document metadata as a dictionary using the <code>metadata</code> method with the default parameter values:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;examples/paul-graham-essay-storage&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">()</span>
</code></pre></div>
The <code>metadata</code> is a dictionary with the document ID as the key and the document metadata as the value:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">documents_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">documents_id</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="p">[</span><span class="s1">&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="p">{</span>
    <span class="s1">&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;</span><span class="p">:</span>
        <span class="n">RefDocInfo</span><span class="p">(</span>
            <span class="n">node_ids</span><span class="o">=</span><span class="p">[</span>
                <span class="s1">&#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;</span><span class="p">,</span>
                <span class="s1">&#39;0567f3a9756983e1d040ec332255db94521ed5dc1b03fc7312f653c0e670a0bf&#39;</span><span class="p">,</span>
                <span class="s1">&#39;d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2df21f0810f10826252f&#39;</span><span class="p">,</span>
                <span class="s1">&#39;120b69658a6c69ab8de3167b5ed0db77941a2b487e94d5d0e64a0d2d2805a4b7&#39;</span>
            <span class="p">],</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="s1">&#39;examples</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">paul_graham_essay.txt&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;paul_graham_essay.txt&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="mi">75395</span><span class="p">,</span>
                <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-10-24&#39;</span><span class="p">,</span>
                <span class="s1">&#39;last_modified_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-09-16&#39;</span><span class="p">,</span>
                <span class="s1">&#39;document_title&#39;</span><span class="p">:</span> <span class="s1">&#39;Based on the candidate titles and content, I would suggest a***.&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>
To get the metadata as a DataFrame, you can set the <code>as_dataframe</code> parameter to True:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">(</span><span class="n">as_dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
                                               <span class="n">doc_id</span>                                            <span class="n">node_id</span>
<span class="mi">0</span>   <span class="n">a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff</span><span class="o">...</span>  <span class="n">cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7</span><span class="o">...</span>
<span class="mi">1</span>   <span class="n">a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff</span><span class="o">...</span>  <span class="mi">0567</span><span class="n">f3a9756983e1d040ec332255db94521ed5dc1b03fc</span><span class="o">...</span>
<span class="mi">2</span>   <span class="n">a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff</span><span class="o">...</span>  <span class="n">d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d</span><span class="o">...</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">document_metadata</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">as_dataframe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RefDocInfo</span><span class="p">],</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Document metadata.</span>

<span class="sd">    Get the metadata of all the documents in the docstore.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    as_dataframe: bool, optional, default is False.</span>
<span class="sd">        True to return the metadata as a DataFrame.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[str, RefDocInfo] or DataFrame</span>
<span class="sd">        The metadata of all the documents in the docstore.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can get the document metadata as a dictionary using the `metadata` method with the default parameter values:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">    &gt;&gt;&gt; metadata = store.document_metadata()</span>

<span class="sd">    ```</span>
<span class="sd">    The `metadata` is a dictionary with the document ID as the key and the document metadata as the value:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; documents_id = list(metadata.keys())</span>
<span class="sd">    &gt;&gt;&gt; print(documents_id) # doctest: +SKIP</span>
<span class="sd">    [&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;]</span>
<span class="sd">    &gt;&gt;&gt; print(metadata) # doctest: +SKIP</span>
<span class="sd">    {</span>
<span class="sd">        &#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;:</span>
<span class="sd">            RefDocInfo(</span>
<span class="sd">                node_ids=[</span>
<span class="sd">                    &#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;,</span>
<span class="sd">                    &#39;0567f3a9756983e1d040ec332255db94521ed5dc1b03fc7312f653c0e670a0bf&#39;,</span>
<span class="sd">                    &#39;d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2df21f0810f10826252f&#39;,</span>
<span class="sd">                    &#39;120b69658a6c69ab8de3167b5ed0db77941a2b487e94d5d0e64a0d2d2805a4b7&#39;</span>
<span class="sd">                ],</span>
<span class="sd">                metadata={</span>
<span class="sd">                    &#39;file_path&#39;: &#39;examples\\data\\paul_graham_essay.txt&#39;,</span>
<span class="sd">                    &#39;file_name&#39;: &#39;paul_graham_essay.txt&#39;,</span>
<span class="sd">                    &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                    &#39;file_size&#39;: 75395,</span>
<span class="sd">                    &#39;creation_date&#39;: &#39;2024-10-24&#39;,</span>
<span class="sd">                    &#39;last_modified_date&#39;: &#39;2024-09-16&#39;,</span>
<span class="sd">                    &#39;document_title&#39;: &#39;Based on the candidate titles and content, I would suggest a***.&#39;</span>
<span class="sd">                }</span>
<span class="sd">            )</span>
<span class="sd">        }</span>
<span class="sd">    ```</span>
<span class="sd">    To get the metadata as a DataFrame, you can set the `as_dataframe` parameter to True:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; metadata = store.document_metadata(as_dataframe=True)</span>
<span class="sd">    &gt;&gt;&gt; print(metadata) # doctest: +SKIP</span>
<span class="sd">                                                   doc_id                                            node_id</span>
<span class="sd">    0   a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff...  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>
<span class="sd">    1   a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff...  0567f3a9756983e1d040ec332255db94521ed5dc1b03fc...</span>
<span class="sd">    2   a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ff...  d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d...</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_doc_info</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">get_all_ref_doc_info</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">as_dataframe</span><span class="p">:</span>
        <span class="n">doct_node_ids_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">file_name_doc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">doc_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_doc_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">doc_id</span> <span class="ow">in</span> <span class="n">doc_ids</span><span class="p">:</span>
            <span class="c1"># get the DocRefInfo object for the first document</span>
            <span class="n">doc_ref</span> <span class="o">=</span> <span class="n">ref_doc_info</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="c1"># get the node ids for the first document</span>
            <span class="n">node_ids</span> <span class="o">=</span> <span class="n">doc_ref</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]</span>
            <span class="n">file_name_doc</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc_ref</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_name&quot;</span><span class="p">)</span>
            <span class="n">doct_node_ids_dict</span><span class="p">[</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_ids</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">doct_node_ids_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="s2">&quot;node_id&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># merge the file name with the doc_id</span>
        <span class="n">file_name_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">file_name_doc</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">file_name_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;doc_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="s2">&quot;many_to_one&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ref_doc_info</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.get_nodes_by_file_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nodes_by_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exact_match</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get nodes by file name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file name to search for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exact_match</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to search for an exact match, False to search for a partial match.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="llama_index.core.schema.TextNode">TextNode</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The nodes with the specified file name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <ul>
<li>First read the storage context from a directory:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">storage_dir</span> <span class="o">=</span> <span class="s2">&quot;examples/paul-graham-essay-storage&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>
        <span class="n">Documents</span><span class="p">:</span> <span class="mi">53</span>
        <span class="n">Indexes</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>

<span class="o">-</span> <span class="n">The</span> <span class="n">storage</span> <span class="n">context</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">following</span> <span class="n">data</span><span class="p">:</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">node_metadata</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
               <span class="n">file_name</span>                                            <span class="n">node_id</span>
<span class="mi">0</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="n">cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7</span><span class="o">...</span>
<span class="mi">1</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="mi">0567</span><span class="n">f3a9756983e1d040ec332255db94521ed5dc1b03fc</span><span class="o">...</span>
<span class="mi">2</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>  <span class="n">d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d</span><span class="o">...</span>


<span class="n">You</span> <span class="n">can</span> <span class="n">get</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">nodes</span> <span class="k">for</span> <span class="n">file</span> <span class="err">`</span><span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span><span class="err">`</span> <span class="k">as</span> <span class="n">follows</span><span class="p">:</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get_nodes_by_file_name</span><span class="p">(</span><span class="s2">&quot;paul_graham_essay.txt&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># doctest: +SKIP</span>
<span class="n">TextNode</span><span class="p">(</span>
    <span class="n">id_</span><span class="o">=</span><span class="s1">&#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;</span><span class="p">,</span>
    <span class="n">embedding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="s1">&#39;examples</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">paul_graham_essay.txt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;paul_graham_essay.txt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
        <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="mi">75395</span><span class="p">,</span>
        <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-10-24&#39;</span><span class="p">,</span>
        <span class="s1">&#39;last_modified_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-09-16&#39;</span><span class="p">,</span>
        <span class="s1">&#39;document_title&#39;</span><span class="p">:</span> <span class="s1">&#39;Based on the candidate titles and content, I would suggest a comprehensive title</span>
            <span class="n">that</span> <span class="n">captures</span> <span class="n">the</span> <span class="n">essence</span> <span class="n">of</span> <span class="n">the</span> <span class="n">text</span><span class="o">.</span> <span class="n">Here</span>\<span class="s1">&#39;s a potential title:</span><span class="se">\n\n</span><span class="s1">&quot;From Early Days ***&#39;</span>
    <span class="p">},</span>
    <span class="n">excluded_embed_metadata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span>
    <span class="n">excluded_llm_metadata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span>
    <span class="n">relationships</span><span class="o">=</span><span class="p">{</span>
        <span class="o">&lt;</span><span class="n">NodeRelationship</span><span class="o">.</span><span class="n">SOURCE</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="n">RelatedNodeInfo</span><span class="p">(</span>
            <span class="n">node_id</span><span class="o">=</span><span class="s1">&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;</span><span class="p">,</span>
            <span class="n">node_type</span><span class="o">=&lt;</span><span class="n">ObjectType</span><span class="o">.</span><span class="n">DOCUMENT</span><span class="p">:</span> <span class="s1">&#39;4&#39;</span><span class="o">&gt;</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="s1">&#39;examples</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">paul_graham_essay.txt&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;paul_graham_essay.txt&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
                <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="mi">75395</span><span class="p">,</span>
                <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-10-24&#39;</span><span class="p">,</span>
                <span class="s1">&#39;last_modified_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-09-16&#39;</span>
            <span class="p">},</span>
            <span class="nb">hash</span><span class="o">=</span><span class="s1">&#39;2a494d84cd0ab1e73396773258b809a47739482c90b80d5f61d374e754c3ef06&#39;</span>
        <span class="p">),</span>
        <span class="o">&lt;</span><span class="n">NodeRelationship</span><span class="o">.</span><span class="n">NEXT</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">RelatedNodeInfo</span><span class="p">(</span><span class="n">node_id</span><span class="o">=</span><span class="s1">&#39;15478c7a-fdab-40c8-92e7-42973b9d3b28&#39;</span><span class="p">,</span> <span class="n">node_type</span><span class="o">=&lt;</span><span class="n">ObjectType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{},</span> <span class="nb">hash</span><span class="o">=</span><span class="s1">&#39;424546c0aa78015988ced235522cdd238633d5edc1b92667cbdcda44d72613ec&#39;</span><span class="p">)},</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;What I Worked On</span><span class="se">\r\n\r\n</span><span class="s1">February 2021</span><span class="se">\r\n\r\n</span><span class="s1">Before college the two main things I worked on, outside of school, were writing and programming. I didn</span><span class="se">\&#39;</span><span class="s1">t write essays. I wrote what beginning writers were supposed to write then, and probably still are: short stories. My stories were awful. They had hardly any plot, just characters with strong feelings, which I imagined made them deep.</span><span class="se">\r\n\r\n</span><span class="s1">The first programs I tried writing were on the IBM 1401 that our school district used for what was then called &quot;data processing.&quot; This was in 9th grade, so I was 13 or 14. The school district</span><span class="se">\&#39;</span><span class="s1">s 1401 happened to be in the basement of our junior high school, and my friend Rich Draves and I got permission to use it. It was like a mini Bond villain</span><span class="se">\&#39;</span><span class="s1">s lair down there, with all these alien-looking machines  CPU, disk drives, printer, card reader  sitting up on a raised floor under bright fluorescent lights.</span><span class="se">\r\n\r\n</span><span class="s1">The language we used was an early version of Fortran. You had to type programs on punch cards, then stack them in the card reader and press a button to load the program into memory and run it. The result would ordinarily be to print something on the spectacularly loud printer.</span><span class="se">\r\n\r\n</span><span class="s1">I was puzzled by the 1401. I couldn</span><span class="se">\&#39;</span><span class="s1">t figure out what to do with it. And in retrospect there</span><span class="se">\&#39;</span><span class="s1">s not much I could have&#39;</span><span class="p">,</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
        <span class="n">start_char_idx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">end_char_idx</span><span class="o">=</span><span class="mi">2027</span><span class="p">,</span>
        <span class="n">text_template</span><span class="o">=</span><span class="s1">&#39;[Excerpt from document]</span><span class="se">\n</span><span class="si">{metadata_str}</span><span class="se">\n</span><span class="s1">Excerpt:</span><span class="se">\n</span><span class="s1">-----</span><span class="se">\n</span><span class="si">{content}</span><span class="se">\n</span><span class="s1">-----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">metadata_template</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{key}</span><span class="s1">: </span><span class="si">{value}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">metadata_seperator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>
</code></pre></div></li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nodes_by_file_name</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exact_match</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get nodes by file name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_name: str</span>
<span class="sd">        The file name to search for.</span>
<span class="sd">    exact_match: bool, optional, default is False</span>
<span class="sd">        True to search for an exact match, False to search for a partial match.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[TextNode]</span>
<span class="sd">        The nodes with the specified file name.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    - First read the storage context from a directory:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; storage_dir = &quot;examples/paul-graham-essay-storage&quot;</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.load(storage_dir)</span>
<span class="sd">    &gt;&gt;&gt; print(store)</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">            Documents: 53</span>
<span class="sd">            Indexes: 2</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>

<span class="sd">    - The storage context contains the following data:</span>

<span class="sd">    &gt;&gt;&gt; print(store.node_metadata.head(3))</span>
<span class="sd">                   file_name                                            node_id</span>
<span class="sd">    0  paul_graham_essay.txt  cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7...</span>
<span class="sd">    1  paul_graham_essay.txt  0567f3a9756983e1d040ec332255db94521ed5dc1b03fc...</span>
<span class="sd">    2  paul_graham_essay.txt  d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2d...</span>


<span class="sd">    You can get all the nodes for file `paul_graham_essay.txt` as follows:</span>


<span class="sd">    &gt;&gt;&gt; nodes = store.get_nodes_by_file_name(&quot;paul_graham_essay.txt&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes[0] # doctest: +SKIP</span>
<span class="sd">    TextNode(</span>
<span class="sd">        id_=&#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;,</span>
<span class="sd">        embedding=None,</span>
<span class="sd">        metadata={</span>
<span class="sd">            &#39;file_path&#39;: &#39;examples\\data\\paul_graham_essay.txt&#39;,</span>
<span class="sd">            &#39;file_name&#39;: &#39;paul_graham_essay.txt&#39;,</span>
<span class="sd">            &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">            &#39;file_size&#39;: 75395,</span>
<span class="sd">            &#39;creation_date&#39;: &#39;2024-10-24&#39;,</span>
<span class="sd">            &#39;last_modified_date&#39;: &#39;2024-09-16&#39;,</span>
<span class="sd">            &#39;document_title&#39;: &#39;Based on the candidate titles and content, I would suggest a comprehensive title</span>
<span class="sd">                that captures the essence of the text. Here\&#39;s a potential title:\n\n&quot;From Early Days ***&#39;</span>
<span class="sd">        },</span>
<span class="sd">        excluded_embed_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">        excluded_llm_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">        relationships={</span>
<span class="sd">            &lt;NodeRelationship.SOURCE: &#39;1&#39;&gt;:</span>
<span class="sd">            RelatedNodeInfo(</span>
<span class="sd">                node_id=&#39;a25111e2e59f81bb7a0e3efb48255f4a5d4f722aaf13ffd112463fb98c227092&#39;,</span>
<span class="sd">                node_type=&lt;ObjectType.DOCUMENT: &#39;4&#39;&gt;,</span>
<span class="sd">                metadata={</span>
<span class="sd">                    &#39;file_path&#39;: &#39;examples\\data\\paul_graham_essay.txt&#39;,</span>
<span class="sd">                    &#39;file_name&#39;: &#39;paul_graham_essay.txt&#39;,</span>
<span class="sd">                    &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                    &#39;file_size&#39;: 75395,</span>
<span class="sd">                    &#39;creation_date&#39;: &#39;2024-10-24&#39;,</span>
<span class="sd">                    &#39;last_modified_date&#39;: &#39;2024-09-16&#39;</span>
<span class="sd">                },</span>
<span class="sd">                hash=&#39;2a494d84cd0ab1e73396773258b809a47739482c90b80d5f61d374e754c3ef06&#39;</span>
<span class="sd">            ),</span>
<span class="sd">            &lt;NodeRelationship.NEXT: &#39;3&#39;&gt;: RelatedNodeInfo(node_id=&#39;15478c7a-fdab-40c8-92e7-42973b9d3b28&#39;, node_type=&lt;ObjectType.TEXT: &#39;1&#39;&gt;, metadata={}, hash=&#39;424546c0aa78015988ced235522cdd238633d5edc1b92667cbdcda44d72613ec&#39;)}, text=&#39;What I Worked On\r\n\r\nFebruary 2021\r\n\r\nBefore college the two main things I worked on, outside of school, were writing and programming. I didn\&#39;t write essays. I wrote what beginning writers were supposed to write then, and probably still are: short stories. My stories were awful. They had hardly any plot, just characters with strong feelings, which I imagined made them deep.\r\n\r\nThe first programs I tried writing were on the IBM 1401 that our school district used for what was then called &quot;data processing.&quot; This was in 9th grade, so I was 13 or 14. The school district\&#39;s 1401 happened to be in the basement of our junior high school, and my friend Rich Draves and I got permission to use it. It was like a mini Bond villain\&#39;s lair down there, with all these alien-looking machines  CPU, disk drives, printer, card reader  sitting up on a raised floor under bright fluorescent lights.\r\n\r\nThe language we used was an early version of Fortran. You had to type programs on punch cards, then stack them in the card reader and press a button to load the program into memory and run it. The result would ordinarily be to print something on the spectacularly loud printer.\r\n\r\nI was puzzled by the 1401. I couldn\&#39;t figure out what to do with it. And in retrospect there\&#39;s not much I could have&#39;,</span>
<span class="sd">            mimetype=&#39;text/plain&#39;,</span>
<span class="sd">            start_char_idx=4,</span>
<span class="sd">            end_char_idx=2027,</span>
<span class="sd">            text_template=&#39;[Excerpt from document]\n{metadata_str}\nExcerpt:\n-----\n{content}\n-----\n&#39;,</span>
<span class="sd">            metadata_template=&#39;{key}: {value}&#39;, metadata_seperator=&#39;\n&#39;</span>
<span class="sd">            )</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_metadata</span>
    <span class="k">if</span> <span class="n">exact_match</span><span class="p">:</span>
        <span class="n">doc_ids</span> <span class="o">=</span> <span class="n">metadata_index</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">metadata_index</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;node_id&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">doc_ids</span> <span class="o">=</span> <span class="n">metadata_index</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">metadata_index</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;node_id&quot;</span><span class="p">,</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">(</span><span class="n">doc_ids</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">docs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Storage</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Load the store from a directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store_dir</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory containing the store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Storage</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="llama_utils.retrieval.storage.Storage" href="#llama_utils.retrieval.storage.Storage">Storage</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The loaded storage.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="llama_utils.utils.errors.StorageNotFoundError" href="utils.html#llama_utils.utils.errors.StorageNotFoundError">StorageNotFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the storage is not found at the specified directory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>You can load a storage from a directory as follows:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;examples/paul-graham-essay-storage&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>
            <span class="n">Documents</span><span class="p">:</span> <span class="mi">53</span>
            <span class="n">Indexes</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">&lt;</span><span class="n">BLANKLINE</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">(</span><span class="n">as_dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">head</span><span class="p">())</span> <span class="c1"># doctest: +SKIP</span>
                             <span class="n">doc_id</span>                              <span class="n">node_id</span>              <span class="n">file_name</span>
<span class="mi">0</span>   <span class="n">a25111e2e59f81bb7a0e3efb4825</span><span class="o">...</span>  <span class="n">cadde590b82362fc7a5f8ce0751c5b30b</span><span class="o">...</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>
<span class="mi">1</span>   <span class="n">a25111e2e59f81bb7a0e3efb4825</span><span class="o">...</span>  <span class="mi">0567</span><span class="n">f3a9756983e1d040ec332255db945</span><span class="o">...</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>
<span class="mi">2</span>   <span class="n">a25111e2e59f81bb7a0e3efb4825</span><span class="o">...</span>  <span class="n">d5542515414f1bf30f6c21f0796af8bde</span><span class="o">...</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>
<span class="mi">3</span>   <span class="n">a25111e2e59f81bb7a0e3efb4825</span><span class="o">...</span>  <span class="mi">120</span><span class="n">b69658a6c69ab8de3167b5ed0db779</span><span class="o">...</span>  <span class="n">paul_graham_essay</span><span class="o">.</span><span class="n">txt</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">docstore</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">docstore</span> <span class="c1"># doctest: +SKIP</span>
<span class="o">&lt;</span><span class="n">llama_index</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">simple_docstore</span><span class="o">.</span><span class="n">SimpleDocumentStore</span> <span class="n">at</span> <span class="mh">0x20444d31be0</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vector_store</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">vector_store</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">vector_store</span><span class="p">))</span>
<span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">llama_index</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">vector_stores</span><span class="o">.</span><span class="n">simple</span><span class="o">.</span><span class="n">SimpleVectorStore</span><span class="s1">&#39;&gt;</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Storage&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the store from a directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    store_dir: str</span>
<span class="sd">        The directory containing the store.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Storage:</span>
<span class="sd">        The loaded storage.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    StorageNotFoundError</span>
<span class="sd">        If the storage is not found at the specified directory.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can load a storage from a directory as follows:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(store) # doctest: +SKIP</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">                Documents: 53</span>
<span class="sd">                Indexes: 2</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    &gt;&gt;&gt; metadata = store.document_metadata(as_dataframe=True)</span>
<span class="sd">    &gt;&gt;&gt; print(metadata.head()) # doctest: +SKIP</span>
<span class="sd">                                 doc_id                              node_id              file_name</span>
<span class="sd">    0   a25111e2e59f81bb7a0e3efb4825...  cadde590b82362fc7a5f8ce0751c5b30b...  paul_graham_essay.txt</span>
<span class="sd">    1   a25111e2e59f81bb7a0e3efb4825...  0567f3a9756983e1d040ec332255db945...  paul_graham_essay.txt</span>
<span class="sd">    2   a25111e2e59f81bb7a0e3efb4825...  d5542515414f1bf30f6c21f0796af8bde...  paul_graham_essay.txt</span>
<span class="sd">    3   a25111e2e59f81bb7a0e3efb4825...  120b69658a6c69ab8de3167b5ed0db779...  paul_graham_essay.txt</span>
<span class="sd">    &gt;&gt;&gt; docstore = store.docstore # doctest: +SKIP</span>
<span class="sd">    &lt;llama_index.core.storage.docstore.simple_docstore.SimpleDocumentStore at 0x20444d31be0&gt;</span>
<span class="sd">    &gt;&gt;&gt; vector_store = store.vector_store</span>
<span class="sd">    &gt;&gt;&gt; print(type(vector_store))</span>
<span class="sd">    &lt;class &#39;llama_index.core.vector_stores.simple.SimpleVectorStore&#39;&gt;</span>

<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">store_dir</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">StorageNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storage not found at </span><span class="si">{</span><span class="n">store_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="n">StorageContext</span><span class="o">.</span><span class="n">from_defaults</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="n">store_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.node_id_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">node_id_list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get the metadata of the nodes in the docstore.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>[str, Any]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metadata of the nodes in the docstore.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>You can get the metadata of the nodes in the docstore using the <code>nodes_metadata</code> method:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;examples/paul-graham-essay-storage&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nodes_metadata</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">node_id_list</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">nodes_metadata</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="p">[</span>
    <span class="s1">&#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;</span><span class="p">,</span>
    <span class="s1">&#39;0567f3a9756983e1d040ec332255db94521ed5dc1b03fc7312f653c0e670a0bf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2df21f0810f10826252f&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">]</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">node_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the metadata of the nodes in the docstore.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[str, Dict[str, Any]]</span>
<span class="sd">        The metadata of the nodes in the docstore.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can get the metadata of the nodes in the docstore using the `nodes_metadata` method:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.load(&quot;examples/paul-graham-essay-storage&quot;)</span>
<span class="sd">    &gt;&gt;&gt; nodes_metadata = store.node_id_list()</span>
<span class="sd">    &gt;&gt;&gt; print(nodes_metadata) # doctest: +SKIP</span>
<span class="sd">    [</span>
<span class="sd">        &#39;cadde590b82362fc7a5f8ce0751c5b30b11c0f81369df7d83a76956bf22765b7&#39;,</span>
<span class="sd">        &#39;0567f3a9756983e1d040ec332255db94521ed5dc1b03fc7312f653c0e670a0bf&#39;,</span>
<span class="sd">        &#39;d5542515414f1bf30f6c21f0796af8bde4c513f2e72a2df21f0810f10826252f&#39;,</span>
<span class="sd">        ...</span>
<span class="sd">    ]</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docstore</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.read_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_documents</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">split_into_nodes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">chunk_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">TextNode</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Read documents from a directory and optionally splits them into TextNodes.</p>
<p>the <code>read_documents</code> method reads documents from a directory and returns a list of documents.
the <code>doc_id</code> is sha256 hash number generated based on the document's text content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the directory containing the documents. or a single file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>split_into_nodes</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, splits documents into smaller TextNodes (default: False).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_size</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of each text chunk. The <code>chunk_size</code> Defines the size of each split chunk (in characters).
- Larger values preserve more context but increase memory usage.
- Smaller values improve retrieval specificity but may lose context.</p>
              </div>
            </td>
            <td>
                  <code>is 1024</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_overlap</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The overlap size between chunks. The <code>chunk_overlap</code> ensures adjacent chunks have overlapping content to
preserve context.
- Higher overlap improves retrieval coherence but increases redundancy.
- Lower overlap minimizes redundancy but might break context.</p>
              </div>
            </td>
            <td>
                  <code>is 100.</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_progress</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to show progress bar.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_workers</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of workers to use for loading the data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>recursive</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True to read from subdirectories.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="typing.Union">Union</span>[<span title="llama_index.core.schema.Document">Document</span>, <span title="llama_index.core.schema.TextNode">TextNode</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The documents/nodes read from the store.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>FileNotFoundError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the directory is not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The best values for <code>chunk_size</code> and <code>chunk_overlap</code> depend on the type of documents and retrieval needs.</p>
<table>
<thead>
<tr>
<th><strong>Use Case</strong></th>
<th><strong>Recommended <code>chunk_size</code></strong></th>
<th><strong>Recommended <code>chunk_overlap</code></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Short documents (FAQs, structured text, emails)</strong></td>
<td><code>256 - 512</code></td>
<td><code>50</code></td>
</tr>
<tr>
<td><strong>General-purpose (news articles, reports, blog posts)</strong></td>
<td><code>512 - 1024</code></td>
<td><code>50 - 100</code></td>
</tr>
<tr>
<td><strong>Long documents (PDFs, research papers, books)</strong></td>
<td><code>1024 - 2048</code></td>
<td><code>100 - 200</code></td>
</tr>
<tr>
<td><strong>Dense technical/scientific papers</strong></td>
<td><code>1500 - 2500</code></td>
<td><code>200 - 300</code></td>
</tr>
<tr>
<td><strong>Conversational AI (chat context memory)</strong></td>
<td><code>512 - 1024</code></td>
<td><code>50 - 150</code></td>
</tr>
<tr>
<td><strong>Legal/contract documents (precise context retention)</strong></td>
<td><code>2048 - 4096</code></td>
<td><code>200 - 400</code></td>
</tr>
</tbody>
</table>
<p>Best Practices:
- For most cases, <code>chunk_size=1024</code> and <code>chunk_overlap=100</code> work well.
- If working with FAQs, decrease <code>chunk_size</code> to <code>512</code>.
- If preserving long-form LLM context, use <code>2048+</code> with higher overlap.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <p>You can read documents from a directory as follows:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">llama_utils.retrieval.storage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Storage</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/essay&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">docs</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">read_documents</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="c1"># doctest: +SKIP</span>
<span class="p">[</span>
    <span class="n">Document</span><span class="p">(</span>
        <span class="n">id_</span><span class="o">=</span><span class="s1">&#39;a25111e2e59f81bb7a0e3efb48255**&#39;</span><span class="p">,</span>
        <span class="n">embedding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="s1">&#39;examples/data/essay/paul-graham-essay.txt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="s1">&#39;paul-graham-essay.txt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;file_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
            <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="mi">75395</span><span class="p">,</span>
            <span class="s1">&#39;creation_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-10-25&#39;</span><span class="p">,</span>
            <span class="s1">&#39;last_modified_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-09-16&#39;</span>
        <span class="p">},</span>
        <span class="n">excluded_embed_metadata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span>
        <span class="n">excluded_llm_metadata_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span>
        <span class="n">relationships</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;What I Worked On</span><span class="se">\n\n</span><span class="s1">February 2021</span><span class="se">\n\n</span><span class="s1">Before college the two main things ****&#39;</span><span class="p">,</span>
        <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
        <span class="n">start_char_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_char_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="mi">4</span>        <span class="n">text_template</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{metadata_str}</span><span class="se">\n\n</span><span class="si">{content}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">metadata_template</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{key}</span><span class="s1">: </span><span class="si">{value}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">metadata_seperator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="p">)</span>
<span class="p">]</span>
</code></pre></div></p>
<p>You can also use the <code>split_into_nodes</code> parameter to split the documents into smaller nodes:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">docs</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">read_documents</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">split_into_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">))</span>
<span class="mi">20</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># doctest: +SKIP</span>
<span class="n">Node</span> <span class="n">ID</span><span class="p">:</span> <span class="n">bfdf48ff</span><span class="o">-</span><span class="mi">3</span><span class="n">c2b</span><span class="o">-</span><span class="mi">49</span><span class="n">a8</span><span class="o">-</span><span class="n">ae25</span><span class="o">-</span><span class="mi">7</span><span class="n">a837158d2dc</span>
<span class="n">Text</span><span class="p">:</span> <span class="n">What</span> <span class="n">I</span> <span class="n">Worked</span> <span class="n">On</span>    <span class="n">February</span> <span class="mi">2021</span>    <span class="n">Before</span> <span class="n">college</span> <span class="n">the</span> <span class="n">two</span> <span class="n">main</span>
<span class="n">things</span> <span class="n">I</span> <span class="n">worked</span> <span class="n">on</span><span class="p">,</span> <span class="n">outside</span> <span class="n">of</span> <span class="n">school</span><span class="p">,</span> <span class="n">were</span> <span class="n">writing</span> <span class="ow">and</span> <span class="n">programming</span><span class="o">.</span> <span class="n">I</span>
<span class="n">didn</span><span class="s1">&#39;t write essays. I wrote what beginning writers were supposed to</span>
<span class="n">write</span> <span class="n">then</span><span class="p">,</span> <span class="ow">and</span> <span class="n">probably</span> <span class="n">still</span> <span class="n">are</span><span class="p">:</span> <span class="n">short</span> <span class="n">stories</span><span class="o">.</span> <span class="n">My</span> <span class="n">stories</span> <span class="n">were</span>
<span class="n">awful</span><span class="o">.</span> <span class="n">They</span> <span class="n">had</span> <span class="n">hardly</span> <span class="nb">any</span> <span class="n">plot</span><span class="p">,</span> <span class="n">just</span> <span class="n">characters</span> <span class="k">with</span> <span class="n">strong</span> <span class="n">feelings</span><span class="p">,</span>
<span class="n">whic</span><span class="o">...</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">read_documents</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
    <span class="n">split_into_nodes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
    <span class="n">chunk_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Document</span><span class="p">,</span> <span class="n">TextNode</span><span class="p">]]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Read documents from a directory and optionally splits them into TextNodes.</span>

<span class="sd">    the `read_documents` method reads documents from a directory and returns a list of documents.</span>
<span class="sd">    the `doc_id` is sha256 hash number generated based on the document&#39;s text content.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        path to the directory containing the documents. or a single file path.</span>
<span class="sd">    split_into_nodes : bool, optional</span>
<span class="sd">        If True, splits documents into smaller TextNodes (default: False).</span>
<span class="sd">    chunk_size : int, optional, default is 1024</span>
<span class="sd">        The size of each text chunk. The `chunk_size` Defines the size of each split chunk (in characters).</span>
<span class="sd">        - Larger values preserve more context but increase memory usage.</span>
<span class="sd">        - Smaller values improve retrieval specificity but may lose context.</span>
<span class="sd">    chunk_overlap : int, optional, default is 100.</span>
<span class="sd">        The overlap size between chunks. The `chunk_overlap` ensures adjacent chunks have overlapping content to</span>
<span class="sd">        preserve context.</span>
<span class="sd">        - Higher overlap improves retrieval coherence but increases redundancy.</span>
<span class="sd">        - Lower overlap minimizes redundancy but might break context.</span>
<span class="sd">    show_progress: bool, optional, default is False.</span>
<span class="sd">        True to show progress bar.</span>
<span class="sd">    num_workers: int, optional, default is None.</span>
<span class="sd">        The number of workers to use for loading the data.</span>
<span class="sd">    recursive: bool, optional, default is False.</span>
<span class="sd">        True to read from subdirectories.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Sequence[Union[Document, TextNode]]</span>
<span class="sd">        The documents/nodes read from the store.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    FileNotFoundError</span>
<span class="sd">        If the directory is not found.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The best values for `chunk_size` and `chunk_overlap` depend on the type of documents and retrieval needs.</span>

<span class="sd">    | **Use Case**                                              | **Recommended `chunk_size`** | **Recommended `chunk_overlap`** |</span>
<span class="sd">    |-----------------------------------------------------------|------------------------------|---------------------------------|</span>
<span class="sd">    | **Short documents (FAQs, structured text, emails)**       | `256 - 512`                  | `50`                           |</span>
<span class="sd">    | **General-purpose (news articles, reports, blog posts)**  | `512 - 1024`                 | `50 - 100`                     |</span>
<span class="sd">    | **Long documents (PDFs, research papers, books)**         | `1024 - 2048`                | `100 - 200`                    |</span>
<span class="sd">    | **Dense technical/scientific papers**                     | `1500 - 2500`                | `200 - 300`                    |</span>
<span class="sd">    | **Conversational AI (chat context memory)**               | `512 - 1024`                 | `50 - 150`                     |</span>
<span class="sd">    | **Legal/contract documents (precise context retention)**  | `2048 - 4096`                | `200 - 400`                    |</span>

<span class="sd">    Best Practices:</span>
<span class="sd">    - For most cases, `chunk_size=1024` and `chunk_overlap=100` work well.</span>
<span class="sd">    - If working with FAQs, decrease `chunk_size` to `512`.</span>
<span class="sd">    - If preserving long-form LLM context, use `2048+` with higher overlap.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can read documents from a directory as follows:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; from llama_utils.retrieval.storage import Storage</span>
<span class="sd">    &gt;&gt;&gt; data_path = &quot;examples/data/essay&quot;</span>
<span class="sd">    &gt;&gt;&gt; docs = Storage.read_documents(data_path)</span>
<span class="sd">    &gt;&gt;&gt; print(docs) # doctest: +SKIP</span>
<span class="sd">    [</span>
<span class="sd">        Document(</span>
<span class="sd">            id_=&#39;a25111e2e59f81bb7a0e3efb48255**&#39;,</span>
<span class="sd">            embedding=None,</span>
<span class="sd">            metadata={</span>
<span class="sd">                &#39;file_path&#39;: &#39;examples/data/essay/paul-graham-essay.txt&#39;,</span>
<span class="sd">                &#39;file_name&#39;: &#39;paul-graham-essay.txt&#39;,</span>
<span class="sd">                &#39;file_type&#39;: &#39;text/plain&#39;,</span>
<span class="sd">                &#39;file_size&#39;: 75395,</span>
<span class="sd">                &#39;creation_date&#39;: &#39;2024-10-25&#39;,</span>
<span class="sd">                &#39;last_modified_date&#39;: &#39;2024-09-16&#39;</span>
<span class="sd">            },</span>
<span class="sd">            excluded_embed_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">            excluded_llm_metadata_keys=[&#39;file_name&#39;],</span>
<span class="sd">            relationships={},</span>
<span class="sd">            text=&#39;What I Worked On\n\nFebruary 2021\n\nBefore college the two main things ****&#39;,</span>
<span class="sd">            mimetype=&#39;text/plain&#39;,</span>
<span class="sd">            start_char_idx=None,</span>
<span class="sd">            end_char_idx=None,</span>
<span class="sd">    4        text_template=&#39;{metadata_str}\n\n{content}&#39;,</span>
<span class="sd">            metadata_template=&#39;{key}: {value}&#39;,</span>
<span class="sd">            metadata_seperator=&#39;\n&#39;</span>
<span class="sd">        )</span>
<span class="sd">    ]</span>
<span class="sd">    ```</span>

<span class="sd">    You can also use the `split_into_nodes` parameter to split the documents into smaller nodes:</span>

<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; docs = Storage.read_documents(data_path, split_into_nodes=True)</span>
<span class="sd">    &gt;&gt;&gt; print(len(docs))</span>
<span class="sd">    20</span>
<span class="sd">    &gt;&gt;&gt; print(docs[0]) # doctest: +SKIP</span>
<span class="sd">    Node ID: bfdf48ff-3c2b-49a8-ae25-7a837158d2dc</span>
<span class="sd">    Text: What I Worked On    February 2021    Before college the two main</span>
<span class="sd">    things I worked on, outside of school, were writing and programming. I</span>
<span class="sd">    didn&#39;t write essays. I wrote what beginning writers were supposed to</span>
<span class="sd">    write then, and probably still are: short stories. My stories were</span>
<span class="sd">    awful. They had hardly any plot, just characters with strong feelings,</span>
<span class="sd">    whic...</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">SimpleDirectoryReader</span><span class="p">(</span><span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">SimpleDirectoryReader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">documents</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span>
        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">split_into_nodes</span><span class="p">:</span>
        <span class="c1"># Split documents into nodes.</span>
        <span class="n">splitter</span> <span class="o">=</span> <span class="n">SentenceSplitter</span><span class="p">(</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">chunk_overlap</span><span class="o">=</span><span class="n">chunk_overlap</span>
        <span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">get_nodes_from_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
        <span class="c1"># exclude the file name from the llm metadata to avoid affecting the llm by weird file names</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">excluded_llm_metadata_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
        <span class="c1"># exclude the file name from the embeddings&#39; metadata to avoid affecting the llm by weird file names</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">excluded_embed_metadata_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
        <span class="c1"># Generate a hash based on the document&#39;s text content</span>
        <span class="n">content_hash</span> <span class="o">=</span> <span class="n">generate_content_hash</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># Assign the hash as the doc_id</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;content-hash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_hash</span>

    <span class="k">return</span> <span class="n">documents</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="llama_utils.retrieval.storage.Storage.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Save the storage to a directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>store_dir</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory to save the store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>You can save a storage to a directory as follows:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">store</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;examples/paul-graham-essay-storage-example&quot;</span><span class="p">)</span>
</code></pre></div>
The following files will be created in the specified directory:
- metadata_index.csv
- docstore.json
- default__vector_store.json
- index_store.json
- graph_store.json
- image__vector_store.json</p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the storage to a directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    store_dir: str</span>
<span class="sd">        The directory to save the store.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    You can save a storage to a directory as follows:</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; store = Storage.create()</span>
<span class="sd">    &gt;&gt;&gt; store.save(&quot;examples/paul-graham-essay-storage-example&quot;)</span>

<span class="sd">    ```</span>
<span class="sd">    The following files will be created in the specified directory:</span>
<span class="sd">    - metadata_index.csv</span>
<span class="sd">    - docstore.json</span>
<span class="sd">    - default__vector_store.json</span>
<span class="sd">    - index_store.json</span>
<span class="sd">    - graph_store.json</span>
<span class="sd">    - image__vector_store.json</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_dir</span><span class="o">=</span><span class="n">store_dir</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">store_dir</span><span class="p">,</span> <span class="n">ID_MAPPING_FILE</span><span class="p">)</span>
    <span class="n">save_metadata_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document_metadata</span><span class="p">(</span><span class="n">as_dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="llama_utils.retrieval.storage.create_metadata_index_existing_docs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_metadata_index_existing_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseNode</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a metadata index for existing documents.</p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_metadata_index_existing_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseNode</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a metadata index for existing documents.&quot;&quot;&quot;</span>
    <span class="n">metadata_index</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">docs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;file_name&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;file_path&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;doc_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">metadata_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
            <span class="s2">&quot;node_id&quot;</span><span class="p">:</span> <span class="n">generate_content_hash</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">text</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">metadata_index</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_utils.retrieval.storage.read_metadata_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_metadata_index</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Read the ID mapping from a JSON file.</p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_metadata_index</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the ID mapping from a JSON file.&quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ID_MAPPING_FILE</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="llama_utils.retrieval.storage.save_metadata_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_metadata_index</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save the ID mapping to a JSON file.</p>

            <details class="quote">
              <summary>Source code in <code>src/llama_utils/retrieval/storage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_metadata_index</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the ID mapping to a JSON file.&quot;&quot;&quot;</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="index_manager.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Index Manager">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Index Manager
              </div>
            </div>
          </a>
        
        
          
          <a href="pdf_reader.html" class="md-footer__link md-footer__link--next" aria-label="Next: pdf_reader">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                pdf_reader
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>